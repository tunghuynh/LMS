<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti·∫øt kh√≥a h·ªçc | E-Learning Platform</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    
    <style>
        .course-hero {
            background: linear-gradient(135deg, var(--primary-blue), #1e5a94);
            color: var(--white);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-lg);
        }

        .hero-content {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: var(--spacing-xl);
            align-items: start;
        }

        .hero-info {
            flex: 1;
        }

        .course-category {
            font-size: var(--font-size-small);
            opacity: 0.9;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
        }

        .course-title {
            font-size: var(--font-size-h1);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            line-height: 1.2;
        }

        .course-description {
            font-size: var(--font-size-body);
            line-height: 1.6;
            opacity: 0.9;
            margin-bottom: var(--spacing-lg);
        }

        .course-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--spacing-lg);
        }

        .meta-item {
            text-align: center;
        }

        .meta-number {
            font-size: var(--font-size-h3);
            font-weight: bold;
            margin-bottom: var(--spacing-xs);
        }

        .meta-label {
            font-size: var(--font-size-small);
            opacity: 0.8;
        }

        .hero-actions {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            min-width: 200px;
        }

        .price-section {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
            margin-bottom: var(--spacing-md);
        }

        .course-price {
            font-size: var(--font-size-h2);
            font-weight: bold;
            margin-bottom: var(--spacing-xs);
        }

        .price-note {
            font-size: var(--font-size-small);
            opacity: 0.8;
        }

        .enrollment-status {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-sm);
            font-weight: 500;
            text-align: center;
            margin-bottom: var(--spacing-md);
        }

        .enrollment-status.enrolled {
            background: rgba(76, 175, 80, 0.2);
            color: rgba(255, 255, 255, 0.9);
        }

        .enrollment-status.pending {
            background: rgba(255, 152, 0, 0.2);
            color: rgba(255, 255, 255, 0.9);
        }

        .enrollment-status.not-enrolled {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }

        .action-btn {
            padding: var(--spacing-md);
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: block;
        }

        .action-btn.primary {
            background: var(--white);
            color: var(--primary-blue);
        }

        .action-btn.primary:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .action-btn.secondary {
            background: transparent;
            color: var(--white);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .action-btn.secondary:hover {
            border-color: var(--white);
            background: rgba(255, 255, 255, 0.1);
        }

        .tabs-container {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            margin-bottom: var(--spacing-lg);
        }

        .tabs-nav {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            background: var(--light-gray);
        }

        .tab-button {
            flex: 1;
            padding: var(--spacing-md) var(--spacing-lg);
            background: none;
            border: none;
            cursor: pointer;
            font-size: var(--font-size-body);
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            color: var(--primary-blue);
            border-bottom-color: var(--primary-blue);
            background: var(--white);
        }

        .tab-content {
            padding: var(--spacing-xl);
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* Lessons Tab */
        .lessons-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .lessons-stats {
            display: flex;
            gap: var(--spacing-lg);
            font-size: var(--font-size-small);
            color: #666;
        }

        .lesson-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            margin-bottom: var(--spacing-md);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .lesson-item:hover {
            border-color: var(--primary-blue);
            background: rgba(44, 110, 170, 0.05);
        }

        .lesson-item.completed {
            background: rgba(76, 175, 80, 0.05);
            border-color: var(--accent-green);
        }

        .lesson-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: var(--spacing-md);
            flex-shrink: 0;
        }

        .lesson-item.completed .lesson-number {
            background: var(--accent-green);
            color: var(--white);
        }

        .lesson-info {
            flex: 1;
        }

        .lesson-title {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
            color: var(--dark-gray);
        }

        .lesson-meta {
            display: flex;
            gap: var(--spacing-md);
            font-size: var(--font-size-small);
            color: #666;
        }

        .lesson-actions {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .lesson-status {
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-small);
            font-weight: 500;
        }

        .lesson-status.completed {
            background: rgba(76, 175, 80, 0.1);
            color: var(--accent-green);
        }

        .lesson-status.in-progress {
            background: rgba(255, 152, 0, 0.1);
            color: #ff9800;
        }

        .lesson-status.not-started {
            background: rgba(158, 158, 158, 0.1);
            color: #666;
        }

        /* Progress Tab */
        .progress-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
        }

        .progress-card {
            background: var(--light-gray);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
            text-align: center;
        }

        .progress-number {
            font-size: var(--font-size-h2);
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: var(--spacing-xs);
        }

        .progress-label {
            font-size: var(--font-size-small);
            color: #666;
        }

        .progress-chart {
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .chart-placeholder {
            height: 300px;
            background: var(--light-gray);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-style: italic;
        }

        .progress-details {
            background: var(--white);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }

        .progress-table {
            width: 100%;
            border-collapse: collapse;
        }

        .progress-table th {
            background: var(--light-gray);
            padding: var(--spacing-md);
            text-align: left;
            font-weight: 600;
            color: var(--dark-gray);
            border-bottom: 1px solid var(--border-color);
        }

        .progress-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }

        /* Enrollment Tab */
        .enrollment-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .stat-box {
            background: var(--light-gray);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
            text-align: center;
        }

        .stat-number {
            font-size: var(--font-size-h2);
            font-weight: bold;
            color: var(--primary-blue);
            margin-bottom: var(--spacing-xs);
        }

        .stat-label {
            font-size: var(--font-size-small);
            color: #666;
        }

        .enrollment-filters {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            align-items: end;
        }

        .students-table {
            width: 100%;
            border-collapse: collapse;
        }

        .students-table th {
            background: var(--light-gray);
            padding: var(--spacing-md);
            text-align: left;
            font-weight: 600;
            color: var(--dark-gray);
            border-bottom: 1px solid var(--border-color);
        }

        .students-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }

        .student-info {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .student-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--primary-blue);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .progress-bar-small {
            width: 100px;
            height: 8px;
            background: var(--light-gray);
            border-radius: var(--border-radius-sm);
            overflow: hidden;
        }


        @media (max-width: 768px) {
            .hero-content {
                grid-template-columns: 1fr;
                gap: var(--spacing-lg);
            }
            
            .course-meta {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tabs-nav {
                flex-direction: column;
            }
            
            .lesson-item {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-md);
                text-align: center;
            }
            
            .lesson-actions {
                justify-content: center;
            }
            
            .enrollment-filters {
                flex-direction: column;
                align-items: stretch;
            }
        }

        @media (max-width: 480px) {
            .course-meta {
                grid-template-columns: 1fr;
            }
            
            .progress-overview {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="hamburger" id="hamburgerBtn">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="header-logo">üìö EduPlatform</div>
        </div>
        <div class="header-right">
            <div class="header-user" id="userInfo">
                <div class="header-avatar" id="userAvatar">S</div>
                <div class="header-user-info">
                    <span class="header-username" id="userName">Student</span>
                    <span class="header-role" id="userRole">Sinh vi√™n</span>
                </div>
            </div>
            <button class="theme-toggle" onclick="window.themeManager?.toggleTheme()" title="Chuy·ªÉn ƒë·ªïi giao di·ªán">
                <span class="theme-icon">üåô</span>
            </button>
            <button class="btn btn-secondary btn-small" onclick="authManager.logout()">
                ƒêƒÉng xu·∫•t
            </button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Sidebar -->
        <nav class="sidebar sidebar-fixed" id="sidebar">
            <div class="sidebar-nav" id="sidebarNav">
                <!-- Navigation will be populated based on user role -->
            </div>
        </nav>

        <!-- Content -->
        <main class="content main-content" id="content">
            <!-- Course Hero Section -->
            <div class="course-hero">
                <div class="hero-content">
                    <div class="hero-info">
                        <div class="course-category" id="courseCategory">Danh m·ª•c</div>
                        <h1 class="course-title" id="courseTitle">T√™n kh√≥a h·ªçc</h1>
                        <p class="course-description" id="courseDescription">M√¥ t·∫£ kh√≥a h·ªçc</p>
                        
                        <div class="course-meta">
                            <div class="meta-item">
                                <div class="meta-number" id="totalLessons">0</div>
                                <div class="meta-label">B√†i h·ªçc</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-number" id="courseDuration">0h</div>
                                <div class="meta-label">Th·ªùi l∆∞·ª£ng</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-number" id="courseLevel">C∆° b·∫£n</div>
                                <div class="meta-label">C·∫•p ƒë·ªô</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-number" id="courseRating">0</div>
                                <div class="meta-label">ƒê√°nh gi√°</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="hero-actions">
                        <div class="price-section">
                            <div class="course-price" id="coursePrice">Mi·ªÖn ph√≠</div>
                            <div class="price-note">Gi√° kh√≥a h·ªçc</div>
                        </div>
                        
                        <div class="enrollment-status" id="enrollmentStatus">
                            Ch∆∞a ƒëƒÉng k√Ω
                        </div>
                        
                        <div id="actionButtons">
                            <!-- Action buttons will be populated based on user role and enrollment status -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Course Content Tabs -->
            <div class="tabs-container">
                <div class="tabs-nav">
                    <button class="tab-button active" data-tab="lessons">
                        üìñ B√†i h·ªçc
                    </button>
                    <button class="tab-button" data-tab="progress" id="progressTab">
                        üìà Ti·∫øn ƒë·ªô
                    </button>
                    <button class="tab-button" data-tab="enrollment" id="enrollmentTab" style="display: none;">
                        üë• H·ªçc vi√™n
                    </button>
                </div>

                <div class="tab-content">
                    <!-- Lessons Tab -->
                    <div class="tab-panel active" id="lessons">
                        <div class="lessons-header">
                            <h3>Danh s√°ch b√†i h·ªçc</h3>
                            <div class="lessons-stats">
                                <span>üìö <span id="lessonsTotal">0</span> b√†i h·ªçc</span>
                                <span>‚úÖ <span id="lessonsCompleted">0</span> ho√†n th√†nh</span>
                                <span>‚è±Ô∏è <span id="totalDuration">0</span> ph√∫t</span>
                            </div>
                        </div>
                        
                        <div id="lessonsList">
                            <!-- Lessons will be loaded here -->
                        </div>
                    </div>

                    <!-- Progress Tab -->
                    <div class="tab-panel" id="progress">
                        <div class="progress-overview">
                            <div class="progress-card">
                                <div class="progress-number" id="overallProgress">0%</div>
                                <div class="progress-label">Ho√†n th√†nh</div>
                            </div>
                            <div class="progress-card">
                                <div class="progress-number" id="timeSpent">0h</div>
                                <div class="progress-label">Th·ªùi gian h·ªçc</div>
                            </div>
                            <div class="progress-card">
                                <div class="progress-number" id="avgScore">0</div>
                                <div class="progress-label">ƒêi·ªÉm trung b√¨nh</div>
                            </div>
                            <div class="progress-card">
                                <div class="progress-number" id="streak">0</div>
                                <div class="progress-label">Ng√†y li√™n ti·∫øp</div>
                            </div>
                        </div>

                        <div class="progress-chart">
                            <h4 style="margin-bottom: var(--spacing-md);">Bi·ªÉu ƒë·ªì ti·∫øn ƒë·ªô h·ªçc t·∫≠p</h4>
                            <div class="chart-placeholder">
                                üìä Bi·ªÉu ƒë·ªì ti·∫øn ƒë·ªô s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y (Chart.js)
                            </div>
                        </div>

                        <div class="progress-details">
                            <table class="progress-table">
                                <thead>
                                    <tr>
                                        <th>B√†i h·ªçc</th>
                                        <th>Tr·∫°ng th√°i</th>
                                        <th>Th·ªùi gian h·ªçc</th>
                                        <th>ƒêi·ªÉm s·ªë</th>
                                        <th>Ho√†n th√†nh</th>
                                    </tr>
                                </thead>
                                <tbody id="progressTableBody">
                                    <!-- Progress details will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Enrollment Tab (Teacher/Admin only) -->
                    <div class="tab-panel" id="enrollment">
                        <div class="enrollment-stats">
                            <div class="stat-box">
                                <div class="stat-number" id="totalEnrolled">0</div>
                                <div class="stat-label">ƒê√£ ƒëƒÉng k√Ω</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number" id="activeStudents">0</div>
                                <div class="stat-label">ƒêang h·ªçc</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number" id="completedStudents">0</div>
                                <div class="stat-label">Ho√†n th√†nh</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-number" id="avgClassProgress">0%</div>
                                <div class="stat-label">TB Ti·∫øn ƒë·ªô</div>
                            </div>
                        </div>

                        <div class="enrollment-filters">
                            <div class="form-group">
                                <label class="form-label">T√¨m ki·∫øm h·ªçc vi√™n</label>
                                <input type="text" id="studentSearch" class="form-control" placeholder="T√¨m theo t√™n, email...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tr·∫°ng th√°i</label>
                                <select id="studentStatusFilter" class="form-control">
                                    <option value="">T·∫•t c·∫£</option>
                                    <option value="active">ƒêang h·ªçc</option>
                                    <option value="completed">Ho√†n th√†nh</option>
                                    <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
                                </select>
                            </div>
                            <button class="btn btn-secondary" onclick="courseDetail.exportEnrollmentReport()">
                                üì§ Xu·∫•t b√°o c√°o
                            </button>
                        </div>

                        <div style="background: var(--white); border: 1px solid var(--border-color); border-radius: var(--border-radius-md); overflow: hidden;">
                            <table class="students-table">
                                <thead>
                                    <tr>
                                        <th>H·ªçc vi√™n</th>
                                        <th>Ng√†y ƒëƒÉng k√Ω</th>
                                        <th>Ti·∫øn ƒë·ªô</th>
                                        <th>ƒêi·ªÉm TB</th>
                                        <th>Ho·∫°t ƒë·ªông cu·ªëi</th>
                                        <th>Tr·∫°ng th√°i</th>
                                    </tr>
                                </thead>
                                <tbody id="studentsTableBody">
                                    <!-- Students will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer" id="footer">
        <p>&copy; 2025 E-Learning Platform. Ph√°t tri·ªÉn b·ªüi <strong>T√πng Huynh</strong> üé®üíª</p>
    </footer>

    <!-- JavaScript -->
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/components/menu-manager.js"></script>
    <script src="js/theme.js"></script>
    <script>
        class CourseDetail {
            constructor() {
                this.currentUser = null;
                this.course = null;
                this.courseId = null;
                this.userProgress = null;
                this.isEnrolled = false;
                this.enrolledStudents = [];
                
                this.init();
            }

            async init() {
                // Check authentication
                if (!authManager.checkPageAccess(['student', 'teacher', 'admin'])) {
                    return;
                }

                // Get course ID from URL
                const urlParams = new URLSearchParams(window.location.search);
                this.courseId = urlParams.get('id');
                
                if (!this.courseId) {
                    uiManager.showToast('Kh√¥ng t√¨m th·∫•y kh√≥a h·ªçc', 'error');
                    window.location.href = 'courses.html';
                    return;
                }

                this.currentUser = authManager.getCurrentUser();
                this.updateUserInfo();
                this.bindEvents();
                
                await this.loadCourseData();
                
                // Only render if course data was loaded successfully
                if (this.course) {
                    this.renderCourse();
                } else {
                    console.error('Course data not loaded, cannot render');
                }
            }

            bindEvents() {
                // Hamburger menu
                document.getElementById('hamburgerBtn').addEventListener('click', () => {
                    this.toggleSidebar();
                });

                // Tab switching
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.addEventListener('click', () => {
                        this.switchTab(button.dataset.tab);
                    });
                });

                // Student search and filter (for enrollment tab)
                const studentSearch = document.getElementById('studentSearch');
                const statusFilter = document.getElementById('studentStatusFilter');
                
                if (studentSearch) {
                    studentSearch.addEventListener('input', () => {
                        this.filterStudents();
                    });
                }
                
                if (statusFilter) {
                    statusFilter.addEventListener('change', () => {
                        this.filterStudents();
                    });
                }
            }

            toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const content = document.getElementById('content');
                const footer = document.getElementById('footer');

                if (window.innerWidth <= 768) {
                    sidebar.classList.toggle('mobile-open');
                } else {
                    sidebar.classList.toggle('collapsed');
                    content.classList.toggle('sidebar-collapsed');
                    footer.classList.toggle('sidebar-collapsed');
                }
            }

            updateUserInfo() {
                if (this.currentUser) {
                    document.getElementById('userName').textContent = this.currentUser.fullName || this.currentUser.username;
                // Update user role display
                const currentUser = authManager.getCurrentUser();
                if (currentUser) {
                    const roleMap = {
                        'admin': ' Qu·∫£n tr·ªã vi√™n',
                        'teacher': ' Gi·∫£ng vi√™n', 
                        'student': ' H·ªçc vi√™n'
                    };
                    document.getElementById('userRole').textContent = roleMap[currentUser.role] || ' User';
                }
                    document.getElementById('userAvatar').textContent = this.currentUser.fullName ? this.currentUser.fullName.charAt(0).toUpperCase() : 'U';
                }
            }

            async loadCourseData() {
                try {
                    // Load course data from localStorage first, fallback to JSON file
                    let courses = [];
                    
                    // Try to load from localStorage
                    const savedCourses = localStorage.getItem('courses');
                    if (savedCourses) {
                        courses = JSON.parse(savedCourses);
                    } else {
                        // Create initial mock data if localStorage is empty
                        const mockCourses = [
                            {
                                courseId: 'course1',
                                title: 'L·∫≠p tr√¨nh JavaScript c∆° b·∫£n',
                                description: 'H·ªçc JavaScript t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao',
                                category: 'L·∫≠p tr√¨nh',
                                duration: '20h',
                                level: 'Beginner',
                                rating: 4.5,
                                price: 0,
                                instructor: 'Nguy·ªÖn VƒÉn A',
                                lessons: [
                                    { lessonId: 'js1', title: 'Gi·ªõi thi·ªáu JavaScript', type: 'video', duration: '30' },
                                    { lessonId: 'js2', title: 'Bi·∫øn v√† ki·ªÉu d·ªØ li·ªáu', type: 'video', duration: '45' }
                                ]
                            },
                            {
                                courseId: 'course2',
                                title: 'Thi·∫øt k·∫ø UI/UX',
                                description: 'H·ªçc thi·∫øt k·∫ø giao di·ªán ng∆∞·ªùi d√πng',
                                category: 'Thi·∫øt k·∫ø',
                                duration: '15h',
                                level: 'Intermediate',
                                rating: 4.3,
                                price: 500000,
                                instructor: 'Tr·∫ßn Th·ªã B',
                                lessons: [
                                    { lessonId: 'ux1', title: 'Nguy√™n l√Ω thi·∫øt k·∫ø', type: 'video', duration: '40' },
                                    { lessonId: 'ux2', title: 'Figma c∆° b·∫£n', type: 'video', duration: '60' }
                                ]
                            }
                        ];
                        localStorage.setItem('courses', JSON.stringify(mockCourses));
                        courses = mockCourses;
                    }
                    
                    this.course = courses.find(course => course.courseId === this.courseId);
                    
                    if (!this.course) {
                        console.warn('Course not found with ID:', this.courseId);
                        console.warn('Available courses:', courses.map(c => c.courseId));
                        
                        // Create a default course for testing
                        this.course = {
                            courseId: this.courseId,
                            title: 'Kh√≥a h·ªçc Demo',
                            description: 'ƒê√¢y l√† kh√≥a h·ªçc demo ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông',
                            category: 'L·∫≠p tr√¨nh',
                            duration: '10h',
                            level: 'Beginner',
                            rating: 4.5,
                            price: 0,
                            instructor: 'Demo Teacher',
                            lessons: [
                                {
                                    lessonId: 'lesson1',
                                    title: 'B√†i h·ªçc 1: Gi·ªõi thi·ªáu',
                                    type: 'video',
                                    duration: '30',
                                    description: 'B√†i h·ªçc gi·ªõi thi·ªáu'
                                },
                                {
                                    lessonId: 'lesson2', 
                                    title: 'B√†i h·ªçc 2: Th·ª±c h√†nh',
                                    type: 'video',
                                    duration: '45',
                                    description: 'B√†i h·ªçc th·ª±c h√†nh'
                                }
                            ]
                        };
                        
                        uiManager.showToast('ƒêang s·ª≠ d·ª•ng d·ªØ li·ªáu demo cho kh√≥a h·ªçc', 'info');
                    }

                    // Check enrollment status
                    if (this.currentUser.role === 'student') {
                        this.checkEnrollmentStatus();
                        this.loadUserProgress();
                    }

                    // Load enrolled students (for teacher/admin)
                    if (this.currentUser.role === 'teacher' || this.currentUser.role === 'admin') {
                        await this.loadEnrolledStudents();
                        document.getElementById('enrollmentTab').style.display = 'block';
                    }

                } catch (error) {
                    console.error('Error loading course data:', error);
                    uiManager.showToast('C√≥ l·ªói khi t·∫£i d·ªØ li·ªáu kh√≥a h·ªçc', 'error');
                }
            }

            checkEnrollmentStatus() {
                if (this.currentUser.progress && this.currentUser.progress.courses) {
                    const enrollment = this.currentUser.progress.courses.find(c => c.courseId === this.courseId);
                    this.isEnrolled = !!enrollment;
                    this.userProgress = enrollment;
                }
            }

            loadUserProgress() {
                if (this.userProgress) {
                    // Mock progress data
                    this.userProgress.lessonsCompleted = Math.floor(this.course.lessons.length * (this.userProgress.completed / 100));
                    this.userProgress.timeSpent = Math.floor(Math.random() * 20 + 5); // hours
                    this.userProgress.avgScore = Math.floor(Math.random() * 30 + 70);
                    this.userProgress.streak = Math.floor(Math.random() * 10 + 1);
                }
            }

            async loadEnrolledStudents() {
                // Mock enrolled students data
                const users = await authManager.loadUsers();
                const students = users.filter(user => user.role === 'student');
                
                // Mock enrollment data
                this.enrolledStudents = students.slice(0, Math.floor(Math.random() * 10 + 5)).map(student => ({
                    ...student,
                    enrolledAt: this.getRandomDate(),
                    progress: Math.floor(Math.random() * 100),
                    avgScore: Math.floor(Math.random() * 30 + 70),
                    lastActivity: this.getRandomDate(),
                    status: Math.random() > 0.2 ? 'active' : (Math.random() > 0.5 ? 'completed' : 'inactive')
                }));
            }

            renderCourse() {
                // Check if course data is loaded
                if (!this.course) {
                    console.warn('Course data not loaded yet');
                    return;
                }

                // Update course info
                document.getElementById('courseCategory').textContent = this.course.category || 'Ch∆∞a c√≥ danh m·ª•c';
                document.getElementById('courseTitle').textContent = this.course.title || 'ƒêang t·∫£i...';
                document.getElementById('courseDescription').textContent = this.course.description || 'ƒêang t·∫£i m√¥ t·∫£...';
                document.getElementById('totalLessons').textContent = this.course.lessons ? this.course.lessons.length : 0;
                document.getElementById('courseDuration').textContent = this.course.duration || '0h';
                document.getElementById('courseLevel').textContent = this.getLevelDisplay(this.course.level || 'Beginner');
                document.getElementById('courseRating').textContent = this.course.rating || 0;
                
                // Update price
                const priceElement = document.getElementById('coursePrice');
                const price = this.course.price || 0;
                if (price === 0) {
                    priceElement.textContent = 'Mi·ªÖn ph√≠';
                    priceElement.className = 'course-price';
                } else {
                    priceElement.textContent = price.toLocaleString() + ' VNƒê';
                }

                // Update enrollment status and actions
                this.updateEnrollmentStatus();
                this.renderActionButtons();
                
                // Render tabs content
                this.renderLessons();
                this.renderProgress();
                
                if (this.currentUser.role === 'teacher' || this.currentUser.role === 'admin') {
                    this.renderEnrollment();
                }
            }

            updateEnrollmentStatus() {
                const statusElement = document.getElementById('enrollmentStatus');
                
                if (this.currentUser.role === 'student') {
                    if (this.isEnrolled) {
                        statusElement.textContent = 'ƒê√£ ƒëƒÉng k√Ω';
                        statusElement.className = 'enrollment-status enrolled';
                    } else {
                        statusElement.textContent = 'Ch∆∞a ƒëƒÉng k√Ω';
                        statusElement.className = 'enrollment-status not-enrolled';
                    }
                } else {
                    statusElement.style.display = 'none';
                }
            }

            renderActionButtons() {
                const container = document.getElementById('actionButtons');
                let buttonsHTML = '';

                if (this.currentUser.role === 'student') {
                    if (this.isEnrolled) {
                        buttonsHTML = `
                            <a href="lesson.html?courseId=${this.courseId}&lessonId=${this.course.lessons[0].lessonId}" class="action-btn primary">
                                ‚ñ∂Ô∏è ${this.userProgress.completed > 0 ? 'Ti·∫øp t·ª•c h·ªçc' : 'B·∫Øt ƒë·∫ßu h·ªçc'}
                            </a>
                            <button class="action-btn secondary" onclick="courseDetail.viewCertificate()">
                                üèÜ Xem ch·ª©ng ch·ªâ
                            </button>
                        `;
                    } else {
                        buttonsHTML = `
                            <button class="action-btn primary" onclick="courseDetail.enrollCourse()">
                                üìù ƒêƒÉng k√Ω kh√≥a h·ªçc
                            </button>
                            <button class="action-btn secondary" onclick="courseDetail.previewCourse()">
                                üëÄ Xem tr∆∞·ªõc
                            </button>
                        `;
                    }
                } else if (this.currentUser.role === 'teacher') {
                    buttonsHTML = `
                        <button class="action-btn primary" onclick="courseDetail.editCourse()">
                            ‚úèÔ∏è Ch·ªânh s·ª≠a kh√≥a h·ªçc
                        </button>
                        <button class="action-btn secondary" onclick="courseDetail.addLesson()">
                            ‚ûï Th√™m b√†i h·ªçc
                        </button>
                    `;
                } else if (this.currentUser.role === 'admin') {
                    buttonsHTML = `
                        <button class="action-btn primary" onclick="courseDetail.manageCourse()">
                            ‚öôÔ∏è Qu·∫£n l√Ω kh√≥a h·ªçc
                        </button>
                        <button class="action-btn secondary" onclick="courseDetail.viewAnalytics()">
                            üìä Xem th·ªëng k√™
                        </button>
                    `;
                }

                container.innerHTML = buttonsHTML;
            }

            renderLessons() {
                const container = document.getElementById('lessonsList');
                
                // Check if course data is loaded
                if (!this.course || !this.course.lessons) {
                    container.innerHTML = '<p style="text-align: center; padding: var(--spacing-xl);">ƒêang t·∫£i d·ªØ li·ªáu b√†i h·ªçc...</p>';
                    return;
                }
                
                // Update lessons stats
                document.getElementById('lessonsTotal').textContent = this.course.lessons.length;
                
                if (this.userProgress && this.userProgress.lessonsCompleted) {
                    document.getElementById('lessonsCompleted').textContent = this.userProgress.lessonsCompleted;
                } else {
                    document.getElementById('lessonsCompleted').textContent = '0';
                }
                
                const totalDuration = this.course.lessons.reduce((sum, lesson) => {
                    const duration = parseInt(lesson.duration) || 0;
                    return sum + duration;
                }, 0);
                document.getElementById('totalDuration').textContent = totalDuration;

                // Render lesson items
                const lessonsHTML = this.course.lessons.map((lesson, index) => {
                    const isCompleted = this.userProgress && index < this.userProgress.lessonsCompleted;
                    const status = isCompleted ? 'completed' : (index === 0 || this.isEnrolled ? 'available' : 'locked');
                    
                    return `
                        <div class="lesson-item ${isCompleted ? 'completed' : ''}" onclick="courseDetail.goToLesson('${lesson.lessonId}')">
                            <div class="lesson-number">
                                ${isCompleted ? '‚úì' : index + 1}
                            </div>
                            <div class="lesson-info">
                                <div class="lesson-title">${lesson.title}</div>
                                <div class="lesson-meta">
                                    <span>üìπ ${lesson.type === 'video' ? 'Video' : lesson.type === 'pdf' ? 'PDF' : 'Markdown'}</span>
                                    <span>‚è±Ô∏è ${lesson.duration} ph√∫t</span>
                                    ${lesson.description ? `<span>üìù ${lesson.description}</span>` : ''}
                                </div>
                            </div>
                            <div class="lesson-actions">
                                <div class="lesson-status ${isCompleted ? 'completed' : 'not-started'}">
                                    ${isCompleted ? 'Ho√†n th√†nh' : 'Ch∆∞a b·∫Øt ƒë·∫ßu'}
                                </div>
                                ${status === 'available' ? 
                                    `<button class="btn btn-primary btn-small" onclick="event.stopPropagation(); courseDetail.goToLesson('${lesson.lessonId}')">
                                        ${isCompleted ? 'Xem l·∫°i' : 'B·∫Øt ƒë·∫ßu'}
                                    </button>` : 
                                    (status === 'locked' ? '<span style="color: #666;">üîí Kh√≥a</span>' : '')
                                }
                            </div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = lessonsHTML;
            }

            renderProgress() {
                if (this.currentUser.role !== 'student' || !this.userProgress || !this.course || !this.course.lessons) {
                    document.getElementById('progressTab').style.display = 'none';
                    return;
                }

                // Update progress overview
                document.getElementById('overallProgress').textContent = this.userProgress.completed + '%';
                document.getElementById('timeSpent').textContent = this.userProgress.timeSpent + 'h';
                document.getElementById('avgScore').textContent = this.userProgress.avgScore;
                document.getElementById('streak').textContent = this.userProgress.streak;

                // Render progress table
                const tbody = document.getElementById('progressTableBody');
                const progressHTML = this.course.lessons.map((lesson, index) => {
                    const isCompleted = index < this.userProgress.lessonsCompleted;
                    const timeSpent = isCompleted ? Math.floor(Math.random() * 20 + 10) : 0;
                    const score = isCompleted ? Math.floor(Math.random() * 30 + 70) : '-';
                    
                    return `
                        <tr>
                            <td>${lesson.title}</td>
                            <td>
                                <span class="lesson-status ${isCompleted ? 'completed' : 'not-started'}">
                                    ${isCompleted ? 'Ho√†n th√†nh' : 'Ch∆∞a b·∫Øt ƒë·∫ßu'}
                                </span>
                            </td>
                            <td>${timeSpent > 0 ? timeSpent + ' ph√∫t' : '-'}</td>
                            <td>${score}</td>
                            <td>${isCompleted ? uiManager.formatDate(this.getRandomDate()) : '-'}</td>
                        </tr>
                    `;
                }).join('');

                tbody.innerHTML = progressHTML;
            }

            renderEnrollment() {
                // Update enrollment stats
                const totalEnrolled = this.enrolledStudents.length;
                const activeStudents = this.enrolledStudents.filter(s => s.status === 'active').length;
                const completedStudents = this.enrolledStudents.filter(s => s.status === 'completed').length;
                const avgProgress = totalEnrolled > 0 ? 
                    Math.round(this.enrolledStudents.reduce((sum, s) => sum + s.progress, 0) / totalEnrolled) : 0;

                document.getElementById('totalEnrolled').textContent = totalEnrolled;
                document.getElementById('activeStudents').textContent = activeStudents;
                document.getElementById('completedStudents').textContent = completedStudents;
                document.getElementById('avgClassProgress').textContent = avgProgress + '%';

                // Render students table
                this.filterStudents();
            }

            filterStudents() {
                const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
                const statusFilter = document.getElementById('studentStatusFilter').value;

                let filteredStudents = this.enrolledStudents.filter(student => {
                    const matchesSearch = !searchTerm || 
                        student.fullName?.toLowerCase().includes(searchTerm) ||
                        student.username.toLowerCase().includes(searchTerm) ||
                        student.email.toLowerCase().includes(searchTerm);
                    
                    const matchesStatus = !statusFilter || student.status === statusFilter;

                    return matchesSearch && matchesStatus;
                });

                const tbody = document.getElementById('studentsTableBody');
                
                if (filteredStudents.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: var(--spacing-xl); color: #666;">
                                Kh√¥ng t√¨m th·∫•y h·ªçc vi√™n n√†o
                            </td>
                        </tr>
                    `;
                    return;
                }

                const studentsHTML = filteredStudents.map(student => {
                    const statusClass = student.status;
                    const statusText = {
                        'active': 'ƒêang h·ªçc',
                        'completed': 'Ho√†n th√†nh',
                        'inactive': 'Kh√¥ng ho·∫°t ƒë·ªông'
                    }[student.status];

                    return `
                        <tr>
                            <td>
                                <div class="student-info">
                                    <div class="student-avatar">
                                        ${student.fullName ? student.fullName.charAt(0).toUpperCase() : student.username.charAt(0).toUpperCase()}
                                    </div>
                                    <div>
                                        <div style="font-weight: 500;">${student.fullName || student.username}</div>
                                        <div style="font-size: var(--font-size-small); color: #666;">${student.email}</div>
                                    </div>
                                </div>
                            </td>
                            <td>${uiManager.formatDate(student.enrolledAt)}</td>
                            <td>
                                <div class="progress-bar-small">
                                    <div class="progress-fill" style="width: ${student.progress}%"></div>
                                </div>
                                <div style="font-size: var(--font-size-small); text-align: center; margin-top: var(--spacing-xs);">
                                    ${student.progress}%
                                </div>
                            </td>
                            <td>${student.avgScore}</td>
                            <td>${uiManager.formatDate(student.lastActivity)}</td>
                            <td>
                                <span class="lesson-status ${statusClass}">${statusText}</span>
                            </td>
                        </tr>
                    `;
                }).join('');

                tbody.innerHTML = studentsHTML;
            }

            switchTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // Update tab panels
                document.querySelectorAll('.tab-panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById(tabName).classList.add('active');
            }

            goToLesson(lessonId) {
                if (this.isEnrolled || this.currentUser.role !== 'student') {
                    window.location.href = `lesson.html?courseId=${this.courseId}&lessonId=${lessonId}`;
                } else {
                    uiManager.showToast('B·∫°n c·∫ßn ƒëƒÉng k√Ω kh√≥a h·ªçc ƒë·ªÉ xem b√†i h·ªçc', 'warning');
                }
            }

            enrollCourse() {
                uiManager.showConfirm(
                    `B·∫°n c√≥ mu·ªën ƒëƒÉng k√Ω kh√≥a h·ªçc "${this.course.title}"?`,
                    async () => {
                        // Mock enrollment process
                        const currentUser = authManager.getCurrentUser();
                        if (!currentUser.progress) currentUser.progress = { courses: [], quizzes: [] };
                        if (!currentUser.progress.courses) currentUser.progress.courses = [];
                        
                        currentUser.progress.courses.push({
                            courseId: this.courseId,
                            courseName: this.course.title,
                            enrolledAt: new Date().toISOString(),
                            completed: 0
                        });
                        
                        await authManager.updateProfile(currentUser);
                        
                        this.isEnrolled = true;
                        this.checkEnrollmentStatus();
                        this.updateEnrollmentStatus();
                        this.renderActionButtons();
                        this.renderLessons();
                        
                        uiManager.showToast(`ƒê√£ ƒëƒÉng k√Ω kh√≥a h·ªçc "${this.course.title}" th√†nh c√¥ng!`, 'success');
                    }
                );
            }

            previewCourse() {
                this.showCoursePreviewModal();
            }

            showCoursePreviewModal() {
                const modalHtml = `
                    <div class="modal-overlay" id="coursePreviewModal">
                        <div class="modal-container" style="max-width: 900px;">
                            <div class="modal-header">
                                <h3>üëÅÔ∏è Xem tr∆∞·ªõc kh√≥a h·ªçc</h3>
                                <button class="modal-close" onclick="document.getElementById('coursePreviewModal').remove()">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div class="preview-tabs">
                                    <button class="tab-btn active" onclick="courseDetail.showPreviewTab('intro')">üìñ Gi·ªõi thi·ªáu</button>
                                    <button class="tab-btn" onclick="courseDetail.showPreviewTab('curriculum')">üìö N·ªôi dung</button>
                                    <button class="tab-btn" onclick="courseDetail.showPreviewTab('instructor')">üë®‚Äçüè´ Gi·∫£ng vi√™n</button>
                                </div>

                                <div id="introTab" class="tab-content active">
                                    <div class="course-intro-preview">
                                        <div class="course-banner">
                                            <img src="assets/images/course-banner-demo.jpg" alt="Course Banner" 
                                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjBmMGYwIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkNvdXJzZSBCYW5uZXI8L3RleHQ+PC9zdmc+'"
                                                 style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
                                        </div>
                                        <div class="course-info-preview">
                                            <h3>${this.course ? this.course.title : 'Kh√≥a h·ªçc Demo'}</h3>
                                            <p>${this.course ? this.course.description : 'M√¥ t·∫£ kh√≥a h·ªçc demo'}</p>
                                            
                                            <div class="course-highlights">
                                                <div class="highlight-item">
                                                    <span class="highlight-icon">üéØ</span>
                                                    <span>H·ªçc t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao</span>
                                                </div>
                                                <div class="highlight-item">
                                                    <span class="highlight-icon">üì∫</span>
                                                    <span>Video HD ch·∫•t l∆∞·ª£ng cao</span>
                                                </div>
                                                <div class="highlight-item">
                                                    <span class="highlight-icon">üì±</span>
                                                    <span>H·ªó tr·ª£ mobile v√† tablet</span>
                                                </div>
                                                <div class="highlight-item">
                                                    <span class="highlight-icon">üèÜ</span>
                                                    <span>C·∫•p ch·ª©ng ch·ªâ ho√†n th√†nh</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="curriculumTab" class="tab-content">
                                    <div class="curriculum-preview">
                                        <h4>üìö N·ªôi dung kh√≥a h·ªçc</h4>
                                        <div class="lesson-preview-list">
                                            ${this.course && this.course.lessons ? this.course.lessons.map((lesson, index) => `
                                                <div class="lesson-preview-item">
                                                    <div class="lesson-number">${index + 1}</div>
                                                    <div class="lesson-info">
                                                        <div class="lesson-title">${lesson.title}</div>
                                                        <div class="lesson-meta">
                                                            <span class="lesson-type">${lesson.type === 'video' ? 'üìπ Video' : lesson.type === 'pdf' ? 'üìÑ PDF' : 'üìù Text'}</span>
                                                            <span class="lesson-duration">${lesson.duration} ph√∫t</span>
                                                        </div>
                                                    </div>
                                                    <div class="lesson-preview-btn">
                                                        <button class="btn btn-sm btn-secondary" ${lesson.type === 'video' ? `onclick="courseDetail.previewLesson('${lesson.lessonId}')"` : ''}>
                                                            üëÅÔ∏è Xem tr∆∞·ªõc
                                                        </button>
                                                    </div>
                                                </div>
                                            `).join('') : '<p>Ch∆∞a c√≥ n·ªôi dung b√†i h·ªçc</p>'}
                                        </div>
                                    </div>
                                </div>

                                <div id="instructorTab" class="tab-content">
                                    <div class="instructor-preview">
                                        <div class="instructor-profile">
                                            <div class="instructor-avatar">üë®‚Äçüè´</div>
                                            <div class="instructor-info">
                                                <h4>${this.course ? this.course.instructor : 'Gi·∫£ng vi√™n Demo'}</h4>
                                                <p class="instructor-title">Senior Developer & Educator</p>
                                                <div class="instructor-stats">
                                                    <div class="stat">
                                                        <span class="stat-number">5+</span>
                                                        <span class="stat-label">NƒÉm kinh nghi·ªám</span>
                                                    </div>
                                                    <div class="stat">
                                                        <span class="stat-number">1,200+</span>
                                                        <span class="stat-label">H·ªçc vi√™n</span>
                                                    </div>
                                                    <div class="stat">
                                                        <span class="stat-number">4.9</span>
                                                        <span class="stat-label">ƒê√°nh gi√°</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="instructor-bio">
                                            <h5>üìù V·ªÅ gi·∫£ng vi√™n</h5>
                                            <p>V·ªõi h∆°n 5 nƒÉm kinh nghi·ªám trong lƒ©nh v·ª±c c√¥ng ngh·ªá, t√¥i ƒë√£ gi√∫p h√†ng ngh√¨n h·ªçc vi√™n 
                                            th√†nh c√¥ng trong vi·ªác h·ªçc l·∫≠p tr√¨nh v√† ph√°t tri·ªÉn s·ª± nghi·ªáp trong ng√†nh IT.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" onclick="document.getElementById('coursePreviewModal').remove()">
                                    ƒê√≥ng
                                </button>
                                <button class="btn btn-primary" onclick="courseDetail.enrollCourse()">
                                    üéì ƒêƒÉng k√Ω kh√≥a h·ªçc
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }

            showPreviewTab(tabName) {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Show selected tab
                document.getElementById(tabName + 'Tab').classList.add('active');
                event.target.classList.add('active');
            }

            previewLesson(lessonId) {
                // Mock lesson preview
                uiManager.showToast(`ƒêang t·∫£i preview b√†i h·ªçc ${lessonId}...`, 'info');
                
                setTimeout(() => {
                    uiManager.showToast('Ch·ª©c nƒÉng preview video s·∫Ω ƒë∆∞·ª£c b·ªï sung', 'info');
                }, 1000);
            }

            viewCertificate() {
                this.showCertificateModal();
            }

            showCertificateModal() {
                const modalHtml = `
                    <div class="modal-overlay" id="certificateModal">
                        <div class="modal-container" style="max-width: 800px;">
                            <div class="modal-header">
                                <h3>üèÜ Ch·ª©ng ch·ªâ ho√†n th√†nh</h3>
                                <button class="modal-close" onclick="document.getElementById('certificateModal').remove()">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div class="certificate-container">
                                    <div class="certificate-preview">
                                        <div class="certificate-border">
                                            <div class="certificate-header">
                                                <h2>üéì CH·ª®NG CH·ªà HO√ÄN TH√ÄNH</h2>
                                                <div class="certificate-subtitle">Certificate of Completion</div>
                                            </div>
                                            
                                            <div class="certificate-content">
                                                <p class="certificate-text">Ch·ª©ng nh·∫≠n r·∫±ng</p>
                                                <h3 class="student-name">${this.currentUser ? this.currentUser.fullName : 'H·ªçc vi√™n'}</h3>
                                                <p class="certificate-text">ƒë√£ ho√†n th√†nh th√†nh c√¥ng kh√≥a h·ªçc</p>
                                                <h4 class="course-name">${this.course ? this.course.title : 'Kh√≥a h·ªçc Demo'}</h4>
                                                
                                                <div class="certificate-details">
                                                    <div class="detail-row">
                                                        <span>üìÖ Ng√†y ho√†n th√†nh:</span>
                                                        <span>${new Date().toLocaleDateString('vi-VN')}</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span>‚è±Ô∏è Th·ªùi l∆∞·ª£ng:</span>
                                                        <span>${this.course ? this.course.duration : '20h'}</span>
                                                    </div>
                                                    <div class="detail-row">
                                                        <span>üéØ ƒêi·ªÉm s·ªë:</span>
                                                        <span>92/100</span>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="certificate-footer">
                                                <div class="signature">
                                                    <div class="signature-line"></div>
                                                    <div class="signature-text">Gi·∫£ng vi√™n</div>
                                                    <div class="instructor-name">${this.course ? this.course.instructor : 'Instructor'}</div>
                                                </div>
                                                <div class="certificate-seal">
                                                    <div class="seal">üèõÔ∏è</div>
                                                    <div class="platform-name">E-Learning Platform</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" onclick="document.getElementById('certificateModal').remove()">
                                    ƒê√≥ng
                                </button>
                                <button class="btn btn-primary" onclick="courseDetail.downloadCertificate()">
                                    üì• T·∫£i xu·ªëng PDF
                                </button>
                                <button class="btn btn-success" onclick="courseDetail.shareCertificate()">
                                    üì§ Chia s·∫ª
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }

            downloadCertificate() {
                // Mock download certificate
                uiManager.showToast('ƒêang t·∫°o file PDF...', 'info');
                
                setTimeout(() => {
                    // Create a simple text content for demo
                    const certificateContent = `
CH·ª®NG CH·ªà HO√ÄN TH√ÄNH
Certificate of Completion

Ch·ª©ng nh·∫≠n r·∫±ng: ${this.currentUser ? this.currentUser.fullName : 'H·ªçc vi√™n'}
ƒê√£ ho√†n th√†nh kh√≥a h·ªçc: ${this.course ? this.course.title : 'Kh√≥a h·ªçc Demo'}
Ng√†y ho√†n th√†nh: ${new Date().toLocaleDateString('vi-VN')}
ƒêi·ªÉm s·ªë: 92/100

E-Learning Platform
                    `;
                    
                    const blob = new Blob([certificateContent], { type: 'text/plain' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'certificate.txt';
                    a.click();
                    window.URL.revokeObjectURL(url);
                    
                    uiManager.showToast('ƒê√£ t·∫£i ch·ª©ng ch·ªâ (demo text file)', 'success');
                }, 1500);
            }

            shareCertificate() {
                // Mock share certificate
                const shareText = `T√¥i v·ª´a ho√†n th√†nh kh√≥a h·ªçc "${this.course ? this.course.title : 'Kh√≥a h·ªçc Demo'}" tr√™n E-Learning Platform! üéì`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'Ch·ª©ng ch·ªâ ho√†n th√†nh',
                        text: shareText,
                        url: window.location.href
                    });
                } else {
                    // Fallback: copy to clipboard
                    navigator.clipboard.writeText(shareText).then(() => {
                        uiManager.showToast('ƒê√£ copy n·ªôi dung chia s·∫ª v√†o clipboard', 'success');
                    });
                }
            }

            editCourse() {
                // Redirect to course edit page
                window.location.href = `course-edit.html?id=${this.courseId}`;
            }

            addLesson() {
                // Redirect to course edit page with lesson tab
                window.location.href = `course-edit.html?id=${this.courseId}&tab=content`;
            }

            manageCourse() {
                // Show course management modal
                this.showCourseManagementModal();
            }

            viewAnalytics() {
                // Show analytics modal
                this.showAnalyticsModal();
            }

            showCourseManagementModal() {
                const enrolledStudents = this.getEnrolledStudents();
                const modalContent = `
                    <div style="padding: var(--spacing-lg);">
                        <h3 style="margin-bottom: var(--spacing-lg);">üìä Qu·∫£n l√Ω kh√≥a h·ªçc</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                            <div style="text-align: center; padding: var(--spacing-md); background: var(--light-gray); border-radius: var(--border-radius-md);">
                                <div style="font-size: 1.5rem; font-weight: 600; color: var(--primary-blue);">${enrolledStudents.length}</div>
                                <div style="font-size: var(--font-size-small); color: #666;">H·ªçc vi√™n</div>
                            </div>
                            <div style="text-align: center; padding: var(--spacing-md); background: var(--light-gray); border-radius: var(--border-radius-md);">
                                <div style="font-size: 1.5rem; font-weight: 600; color: var(--accent-green);">${this.course.lessons?.length || 0}</div>
                                <div style="font-size: var(--font-size-small); color: #666;">B√†i h·ªçc</div>
                            </div>
                            <div style="text-align: center; padding: var(--spacing-md); background: var(--light-gray); border-radius: var(--border-radius-md);">
                                <div style="font-size: 1.5rem; font-weight: 600; color: var(--primary-blue);">${this.course.rating || 0}</div>
                                <div style="font-size: var(--font-size-small); color: #666;">ƒê√°nh gi√°</div>
                            </div>
                        </div>

                        <div style="display: flex; gap: var(--spacing-md); flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="courseDetail.editCourse()">
                                ‚úèÔ∏è Ch·ªânh s·ª≠a kh√≥a h·ªçc
                            </button>
                            <button class="btn btn-secondary" onclick="courseDetail.addLesson()">
                                ‚ûï Th√™m b√†i h·ªçc
                            </button>
                            <button class="btn btn-accent" onclick="courseDetail.viewAnalytics()">
                                üìà Xem th·ªëng k√™
                            </button>
                            <button class="btn btn-outline" onclick="courseDetail.exportEnrollmentReport()">
                                üì§ Xu·∫•t b√°o c√°o
                            </button>
                        </div>
                    </div>
                `;
                
                uiManager.showModal('alertModal', 'Qu·∫£n l√Ω kh√≥a h·ªçc', modalContent);
            }

            showAnalyticsModal() {
                const enrolledStudents = this.getEnrolledStudents();
                const completionRate = enrolledStudents.length > 0 ? 
                    Math.round((enrolledStudents.filter(s => s.completed > 80).length / enrolledStudents.length) * 100) : 0;
                
                const modalContent = `
                    <div style="padding: var(--spacing-lg);">
                        <h3 style="margin-bottom: var(--spacing-lg);">üìà Th·ªëng k√™ kh√≥a h·ªçc</h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                            <div style="background: linear-gradient(135deg, var(--primary-blue), #1e5a94); color: white; padding: var(--spacing-lg); border-radius: var(--border-radius-md); text-align: center;">
                                <div style="font-size: 2rem; font-weight: 600; margin-bottom: var(--spacing-sm);">${enrolledStudents.length}</div>
                                <div>T·ªïng h·ªçc vi√™n</div>
                            </div>
                            <div style="background: linear-gradient(135deg, var(--accent-green), #45a049); color: white; padding: var(--spacing-lg); border-radius: var(--border-radius-md); text-align: center;">
                                <div style="font-size: 2rem; font-weight: 600; margin-bottom: var(--spacing-sm);">${completionRate}%</div>
                                <div>T·ª∑ l·ªá ho√†n th√†nh</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #ff9800, #f57c00); color: white; padding: var(--spacing-lg); border-radius: var(--border-radius-md); text-align: center;">
                                <div style="font-size: 2rem; font-weight: 600; margin-bottom: var(--spacing-sm);">${this.course.rating || 0}</div>
                                <div>ƒê√°nh gi√° trung b√¨nh</div>
                            </div>
                        </div>

                        <h4 style="margin-bottom: var(--spacing-md);">üìä Ti·∫øn ƒë·ªô h·ªçc vi√™n</h4>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${enrolledStudents.length > 0 ? enrolledStudents.map(student => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: var(--spacing-sm); border-bottom: 1px solid var(--border-color);">
                                    <span>${student.fullName || student.username}</span>
                                    <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                        <div style="width: 100px; height: 6px; background: var(--light-gray); border-radius: 3px; overflow: hidden;">
                                            <div style="width: ${student.completed}%; height: 100%; background: var(--accent-green);"></div>
                                        </div>
                                        <span style="font-size: var(--font-size-small); color: #666;">${student.completed}%</span>
                                    </div>
                                </div>
                            `).join('') : '<p style="text-align: center; color: #666;">Ch∆∞a c√≥ h·ªçc vi√™n n√†o ƒëƒÉng k√Ω</p>'}
                        </div>
                    </div>
                `;
                
                uiManager.showModal('alertModal', 'Th·ªëng k√™ kh√≥a h·ªçc', modalContent);
            }

            getEnrolledStudents() {
                // Get all users and filter enrolled students
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const enrolledStudents = users.filter(user => {
                    if (user.role !== 'student' || !user.progress?.courses) return false;
                    return user.progress.courses.some(course => course.courseId === this.courseId);
                }).map(user => {
                    const courseProgress = user.progress.courses.find(course => course.courseId === this.courseId);
                    return {
                        ...user,
                        completed: courseProgress?.completed || 0
                    };
                });
                
                return enrolledStudents;
            }

            exportEnrollmentReport() {
                uiManager.showToast('ƒêang xu·∫•t b√°o c√°o h·ªçc vi√™n...', 'info');
                setTimeout(() => {
                    uiManager.showToast('Xu·∫•t b√°o c√°o th√†nh c√¥ng! File ƒë√£ ƒë∆∞·ª£c t·∫£i xu·ªëng.', 'success');
                }, 2000);
            }

            getLevelDisplay(level) {
                const levelMap = {
                    'Beginner': 'C∆° b·∫£n',
                    'Intermediate': 'Trung b√¨nh',
                    'Advanced': 'N√¢ng cao'
                };
                return levelMap[level] || level;
            }

            getRandomDate() {
                const start = new Date(2024, 0, 1);
                const end = new Date();
                return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime())).toISOString();
            }
        }

        // Initialize course detail when DOM is loaded
        let courseDetail;
        document.addEventListener('DOMContentLoaded', () => {
            courseDetail = new CourseDetail();
        });
    </script>
</body>
</html> 




