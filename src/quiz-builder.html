<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Táº¡o Quiz | E-Learning Platform</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    
    <style>
        .quiz-builder {
            max-width: 1000px;
            margin: 0 auto;
        }

        .builder-header {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-light);
        }

        .builder-title {
            font-size: var(--font-size-h1);
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: var(--spacing-md);
        }

        .builder-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .progress-info {
            color: #666;
            font-size: var(--font-size-small);
        }

        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
        }

        /* Quiz Settings */
        .quiz-settings {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-light);
        }

        .settings-title {
            font-size: var(--font-size-h2);
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        /* Questions Container */
        .questions-container {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-light);
            overflow: hidden;
        }

        .questions-header {
            background: var(--light-gray);
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .questions-title {
            font-size: var(--font-size-h2);
            font-weight: 600;
            color: var(--dark-gray);
        }

        .add-question-btn {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .questions-list {
            padding: var(--spacing-lg);
        }

        /* Question Item */
        .question-item {
            background: var(--light-gray);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .question-item:hover {
            border-color: var(--primary-blue);
        }

        .question-item.editing {
            border-color: var(--accent-green);
            background: rgba(76, 175, 80, 0.05);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .question-number {
            font-weight: 600;
            color: var(--primary-blue);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .question-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        .question-action-btn {
            padding: var(--spacing-xs);
            border: none;
            background: none;
            cursor: pointer;
            border-radius: var(--border-radius-sm);
            transition: all 0.2s ease;
            color: #666;
        }

        .question-action-btn:hover {
            background: var(--white);
            color: var(--primary-blue);
        }

        .question-form {
            display: grid;
            gap: var(--spacing-md);
        }

        .question-type-selector {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .type-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid var(--border-color);
            background: var(--white);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: var(--font-size-small);
        }

        .type-btn.active {
            background: var(--primary-blue);
            color: var(--white);
            border-color: var(--primary-blue);
        }

        .question-content {
            display: grid;
            gap: var(--spacing-md);
        }

        .question-text-area {
            min-height: 100px;
            resize: vertical;
        }

        /* Options */
        .options-container {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            background: var(--white);
        }

        .options-title {
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--dark-gray);
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            margin-bottom: var(--spacing-sm);
            background: var(--white);
        }

        .option-item.correct {
            border-color: var(--accent-green);
            background: rgba(76, 175, 80, 0.05);
        }

        .option-checkbox {
            flex-shrink: 0;
        }

        .option-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: var(--spacing-xs);
        }

        .option-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .option-action-btn {
            padding: var(--spacing-xs);
            border: none;
            background: none;
            cursor: pointer;
            border-radius: var(--border-radius-sm);
            color: #666;
        }

        .option-action-btn:hover {
            background: var(--light-gray);
        }

        .option-action-btn.correct {
            color: var(--accent-green);
        }

        .add-option-btn {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px dashed var(--border-color);
            background: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            color: #666;
            transition: all 0.2s ease;
        }

        .add-option-btn:hover {
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        /* Question Preview */
        .question-preview {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            background: var(--white);
            margin-top: var(--spacing-md);
        }

        .preview-title {
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--dark-gray);
        }

        .preview-question {
            margin-bottom: var(--spacing-md);
            color: var(--dark-gray);
        }

        .preview-options {
            display: grid;
            gap: var(--spacing-sm);
        }

        .preview-option {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
        }

        .preview-option.correct {
            border-color: var(--accent-green);
            background: rgba(76, 175, 80, 0.05);
        }

        /* Empty State */
        .empty-questions {
            text-align: center;
            padding: var(--spacing-xl);
            color: #666;
        }

        .empty-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        /* Template Section */
        .templates-section {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-light);
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }

        .template-card {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-md);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .template-card:hover {
            border-color: var(--primary-blue);
            background: rgba(44, 110, 170, 0.05);
        }

        .template-icon {
            font-size: 2rem;
            margin-bottom: var(--spacing-sm);
        }

        .template-name {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .template-desc {
            font-size: var(--font-size-small);
            color: #666;
        }

        /* Modal Styles */
        .modal-content {
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .preview-quiz {
            padding: var(--spacing-lg);
        }

        .preview-quiz-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
        }

        .preview-quiz-title {
            font-size: var(--font-size-h1);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
        }

        .preview-quiz-meta {
            display: flex;
            justify-content: center;
            gap: var(--spacing-lg);
            font-size: var(--font-size-small);
            color: #666;
        }

        .preview-question-item {
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-lg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
        }

        .preview-question-number {
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: var(--spacing-md);
        }

        @media (max-width: 768px) {
            .quiz-builder {
                margin: var(--spacing-md);
            }
            
            .builder-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .action-buttons {
                justify-content: space-between;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .question-header {
                flex-direction: column;
                align-items: stretch;
                gap: var(--spacing-md);
            }
            
            .question-type-selector {
                flex-wrap: wrap;
            }
            
            .templates-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .templates-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="hamburger" id="hamburgerBtn">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="header-logo">ð EduPlatform</div>
        </div>
        <div class="header-right">
            <div class="header-user" id="userInfo">
                <div class="header-avatar" id="userAvatar">T</div>
                <div class="header-user-info">
                    <span class="header-username" id="userName">Teacher</span>
                    <span class="header-role" id="userRole">Giáº£ng viÃªn</span>
                </div>
            </div>
            <button class="theme-toggle" onclick="window.themeManager?.toggleTheme()" title="Chuyá»n Äá»i giao diá»n">
                <span class="theme-icon">ð</span>
            </button>
            <button class="btn btn-secondary btn-small" onclick="authManager.logout()">
                ÄÄng xuáº¥t
            </button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Sidebar -->
        <nav class="sidebar sidebar-fixed" id="sidebar">
            <div class="sidebar-nav" id="sidebarNav">
                <!-- Menu will be populated by CommonMenuManager -->
            </div>
        </nav>

        <!-- Content -->
        <main class="content main-content" id="content">
            <div class="quiz-builder">
                <!-- Builder Header -->
                <div class="builder-header">
                    <h1 class="builder-title" id="builderTitle">ð§ Táº¡o Quiz má»i</h1>
                    <div class="builder-actions">
                        <div class="progress-info" id="progressInfo">
                            CÃ¢u há»i: <span id="questionCount">0</span> | Thá»i gian Æ°á»c tÃ­nh: <span id="estimatedTime">0</span> phÃºt
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-secondary" onclick="quizBuilder.previewQuiz()">
                                ðï¸ Xem trÆ°á»c
                            </button>
                            <button class="btn btn-secondary" onclick="quizBuilder.saveAsDraft()">
                                ð¾ LÆ°u nhÃ¡p
                            </button>
                            <button class="btn btn-primary" onclick="quizBuilder.publishQuiz()">
                                ð Xuáº¥t báº£n
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quiz Templates -->
                <div class="templates-section" id="templatesSection">
                    <div class="settings-title">
                        ð Sá»­ dá»¥ng Template
                    </div>
                    <div class="templates-grid">
                        <div class="template-card" onclick="quizBuilder.useTemplate('basic')">
                            <div class="template-icon">ð</div>
                            <div class="template-name">Quiz cÆ¡ báº£n</div>
                            <div class="template-desc">10 cÃ¢u tráº¯c nghiá»m ÄÆ¡n giáº£n</div>
                        </div>
                        <div class="template-card" onclick="quizBuilder.useTemplate('mixed')">
                            <div class="template-icon">ð¯</div>
                            <div class="template-name">Quiz há»n há»£p</div>
                            <div class="template-desc">Káº¿t há»£p nhiá»u loáº¡i cÃ¢u há»i</div>
                        </div>
                        <div class="template-card" onclick="quizBuilder.useTemplate('advanced')">
                            <div class="template-icon">ð</div>
                            <div class="template-name">Quiz nÃ¢ng cao</div>
                            <div class="template-desc">20 cÃ¢u Äa dáº¡ng vÃ  phá»©c táº¡p</div>
                        </div>
                        <div class="template-card" onclick="quizBuilder.importFromExcel()">
                            <div class="template-icon">ð</div>
                            <div class="template-name">Import Excel</div>
                            <div class="template-desc">Táº£i lÃªn file Excel</div>
                        </div>
                    </div>
                </div>

                <!-- Quiz Settings -->
                <div class="quiz-settings">
                    <div class="settings-title">
                        âï¸ CÃ i Äáº·t Quiz
                    </div>
                    <div class="settings-grid">
                        <div class="form-group">
                            <label class="form-label">TÃªn Quiz *</label>
                            <input type="text" id="quizTitle" class="form-control" placeholder="Nháº­p tÃªn quiz...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">KhÃ³a há»c *</label>
                            <select id="quizCourse" class="form-control">
                                <option value="">Chá»n khÃ³a há»c</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Äá» khÃ³</label>
                            <select id="quizDifficulty" class="form-control">
                                <option value="Dá»">Dá»</option>
                                <option value="Trung bÃ¬nh" selected>Trung bÃ¬nh</option>
                                <option value="KhÃ³">KhÃ³</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Thá»i gian (phÃºt)</label>
                            <input type="number" id="quizDuration" class="form-control" value="30" min="5" max="180">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Háº¡n chÃ³t</label>
                            <input type="datetime-local" id="quizDeadline" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Äiá»m tá»i Äa</label>
                            <input type="number" id="quizMaxScore" class="form-control" value="100" min="1" max="1000">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">MÃ´ táº£ Quiz</label>
                        <textarea id="quizDescription" class="form-control" rows="3" placeholder="MÃ´ táº£ ngáº¯n gá»n vá» ná»i dung quiz..."></textarea>
                    </div>
                </div>

                <!-- Questions Container -->
                <div class="questions-container">
                    <div class="questions-header">
                        <h2 class="questions-title">â CÃ¢u há»i</h2>
                        <button class="btn btn-primary add-question-btn" onclick="quizBuilder.addQuestion()">
                            â ThÃªm cÃ¢u há»i
                        </button>
                    </div>
                    <div class="questions-list" id="questionsList">
                        <div class="empty-questions" id="emptyQuestions">
                            <div class="empty-icon">â</div>
                            <p>ChÆ°a cÃ³ cÃ¢u há»i nÃ o. Nháº¥n "ThÃªm cÃ¢u há»i" Äá» báº¯t Äáº§u.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Preview Modal -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ðï¸ Xem trÆ°á»c Quiz</h3>
                <button class="modal-close" onclick="uiManager.hideModal(document.getElementById('previewModal'))">&times;</button>
            </div>
            <div class="modal-body">
                <div class="preview-quiz" id="previewQuiz">
                    <!-- Preview content will be loaded here -->
                </div>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="uiManager.hideModal(document.getElementById('previewModal'))">
                    ÄÃ³ng
                </button>
                <button type="button" class="btn btn-primary" onclick="quizBuilder.publishQuiz()">
                    ð Xuáº¥t báº£n Quiz
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" id="footer">
        <p>&copy; 2025 E-Learning Platform. PhÃ¡t triá»n bá»i <strong>TÃ¹ng Huynh</strong> ð¨ð»</p>
    </footer>

    <!-- JavaScript -->
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/components/menu-manager.js"></script>
    <script>
        class QuizBuilder {
            constructor() {
                this.currentUser = null;
                this.courses = [];
                this.quiz = {
                    title: '',
                    courseId: '',
                    difficulty: 'Trung bÃ¬nh',
                    duration: 30,
                    deadline: '',
                    maxScore: 100,
                    description: '',
                    questions: []
                };
                this.questionCounter = 0;
                this.editingQuestionId = null;
                
                this.init();
            }

            async init() {
                // Check authentication - only teachers and admins can access
                if (!authManager.checkPageAccess(['teacher', 'admin'])) {
                    return;
                }

                this.currentUser = authManager.getCurrentUser();
                this.updateUserInfo();
                this.bindEvents();
                
                await this.loadData();
                this.setupForm();
                this.checkForEditMode();
            }

            bindEvents() {
                // Hamburger menu
                document.getElementById('hamburgerBtn').addEventListener('click', () => {
                    this.toggleSidebar();
                });

                // Form change listeners
                document.getElementById('quizTitle').addEventListener('input', () => this.updateQuizData());
                document.getElementById('quizCourse').addEventListener('change', () => this.updateQuizData());
                document.getElementById('quizDifficulty').addEventListener('change', () => this.updateQuizData());
                document.getElementById('quizDuration').addEventListener('input', () => this.updateQuizData());
                document.getElementById('quizDeadline').addEventListener('change', () => this.updateQuizData());
                document.getElementById('quizMaxScore').addEventListener('input', () => this.updateQuizData());
                document.getElementById('quizDescription').addEventListener('input', () => this.updateQuizData());

                // Auto-save every 30 seconds
                setInterval(() => {
                    this.autoSave();
                }, 30000);
            }

            toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const content = document.getElementById('content');
                const footer = document.getElementById('footer');

                if (window.innerWidth <= 768) {
                    sidebar.classList.toggle('mobile-open');
                } else {
                    sidebar.classList.toggle('collapsed');
                    content.classList.toggle('sidebar-collapsed');
                    footer.classList.toggle('sidebar-collapsed');
                }
            }

            updateUserInfo() {
                if (this.currentUser) {
                    document.getElementById('userName').textContent = this.currentUser.fullName || this.currentUser.username;
                    document.getElementById('userAvatar').textContent = this.currentUser.fullName ? this.currentUser.fullName.charAt(0).toUpperCase() : 'T';
                    document.getElementById('userRole').textContent = this.currentUser.role === 'admin' ? 'ð¨âð» Quáº£n trá» viÃªn' : 'ð¨âð« GiÃ¡o viÃªn';
                }
            }

            async loadData() {
                try {
                    // Load courses data
                    const coursesResponse = await fetch('data/mock-courses.json');
                    const allCourses = await coursesResponse.json();
                    
                    // Filter courses based on user role
                    if (this.currentUser.role === 'teacher') {
                        this.courses = allCourses.filter(course => course.instructor === this.currentUser.username);
                    } else {
                        this.courses = allCourses;
                    }

                } catch (error) {
                    console.error('Error loading data:', error);
                    uiManager.showToast('CÃ³ lá»i khi táº£i dá»¯ liá»u', 'error');
                }
            }

            setupForm() {
                // Populate course dropdown
                const courseSelect = document.getElementById('quizCourse');
                courseSelect.innerHTML = '<option value="">Chá»n khÃ³a há»c</option>';
                
                this.courses.forEach(course => {
                    courseSelect.innerHTML += `<option value="${course.courseId}">${course.title}</option>`;
                });

                // Set default deadline (7 days from now)
                const deadline = new Date();
                deadline.setDate(deadline.getDate() + 7);
                document.getElementById('quizDeadline').value = deadline.toISOString().slice(0, 16);
                
                this.updateProgress();
            }

            checkForEditMode() {
                // Check if editing existing quiz
                const urlParams = new URLSearchParams(window.location.search);
                const quizId = urlParams.get('id');
                
                if (quizId) {
                    this.loadQuizForEdit(quizId);
                    document.getElementById('builderTitle').textContent = 'âï¸ Chá»nh sá»­a Quiz';
                    document.getElementById('templatesSection').style.display = 'none';
                }
            }

            loadQuizForEdit(quizId) {
                // Mock loading quiz data for edit
                const mockQuiz = {
                    id: quizId,
                    title: 'Quiz JavaScript CÆ¡ báº£n',
                    courseId: 'course_1',
                    difficulty: 'Trung bÃ¬nh',
                    duration: 45,
                    deadline: '2024-12-31T23:59',
                    maxScore: 100,
                    description: 'Quiz kiá»m tra kiáº¿n thá»©c JavaScript cÆ¡ báº£n',
                    questions: [
                        {
                            id: 'q1',
                            type: 'radio',
                            question: 'JavaScript lÃ  ngÃ´n ngá»¯ láº­p trÃ¬nh gÃ¬?',
                            options: [
                                { text: 'Compiled language', correct: false },
                                { text: 'Interpreted language', correct: true },
                                { text: 'Assembly language', correct: false },
                                { text: 'Machine language', correct: false }
                            ],
                            points: 10
                        }
                    ]
                };

                this.quiz = mockQuiz;
                this.populateForm();
                this.renderQuestions();
            }

            populateForm() {
                document.getElementById('quizTitle').value = this.quiz.title;
                document.getElementById('quizCourse').value = this.quiz.courseId;
                document.getElementById('quizDifficulty').value = this.quiz.difficulty;
                document.getElementById('quizDuration').value = this.quiz.duration;
                document.getElementById('quizDeadline').value = this.quiz.deadline;
                document.getElementById('quizMaxScore').value = this.quiz.maxScore;
                document.getElementById('quizDescription').value = this.quiz.description;
            }

            updateQuizData() {
                this.quiz.title = document.getElementById('quizTitle').value;
                this.quiz.courseId = document.getElementById('quizCourse').value;
                this.quiz.difficulty = document.getElementById('quizDifficulty').value;
                this.quiz.duration = parseInt(document.getElementById('quizDuration').value);
                this.quiz.deadline = document.getElementById('quizDeadline').value;
                this.quiz.maxScore = parseInt(document.getElementById('quizMaxScore').value);
                this.quiz.description = document.getElementById('quizDescription').value;
                
                this.updateProgress();
            }

            updateProgress() {
                document.getElementById('questionCount').textContent = this.quiz.questions.length;
                
                // Estimate time (2 minutes per question + base time)
                const estimatedTime = Math.max(this.quiz.duration, this.quiz.questions.length * 2);
                document.getElementById('estimatedTime').textContent = estimatedTime;
            }

            addQuestion() {
                this.questionCounter++;
                const questionId = `q_${this.questionCounter}`;
                
                const newQuestion = {
                    id: questionId,
                    type: 'radio',
                    question: '',
                    options: [
                        { text: '', correct: false },
                        { text: '', correct: false }
                    ],
                    points: 10
                };

                this.quiz.questions.push(newQuestion);
                this.renderQuestions();
                this.editQuestion(questionId);
                this.updateProgress();
                
                // Scroll to new question
                setTimeout(() => {
                    const questionElement = document.getElementById(`question-${questionId}`);
                    if (questionElement) {
                        questionElement.scrollIntoView({ behavior: 'smooth' });
                    }
                }, 100);
            }

            renderQuestions() {
                const container = document.getElementById('questionsList');
                const emptyState = document.getElementById('emptyQuestions');

                if (this.quiz.questions.length === 0) {
                    emptyState.style.display = 'block';
                    return;
                }

                emptyState.style.display = 'none';
                
                const questionsHTML = this.quiz.questions.map((question, index) => {
                    const isEditing = this.editingQuestionId === question.id;
                    
                    return `
                        <div class="question-item ${isEditing ? 'editing' : ''}" id="question-${question.id}">
                            <div class="question-header">
                                <div class="question-number">
                                    â CÃ¢u há»i ${index + 1}
                                    <span style="color: #666; font-weight: normal; font-size: var(--font-size-small);">
                                        (${question.points} Äiá»m)
                                    </span>
                                </div>
                                <div class="question-actions">
                                    <button class="question-action-btn" onclick="quizBuilder.editQuestion('${question.id}')" title="Chá»nh sá»­a">
                                        âï¸
                                    </button>
                                    <button class="question-action-btn" onclick="quizBuilder.moveQuestionUp(${index})" title="Di chuyá»n lÃªn" ${index === 0 ? 'disabled' : ''}>
                                        â¬ï¸
                                    </button>
                                    <button class="question-action-btn" onclick="quizBuilder.moveQuestionDown(${index})" title="Di chuyá»n xuá»ng" ${index === this.quiz.questions.length - 1 ? 'disabled' : ''}>
                                        â¬ï¸
                                    </button>
                                    <button class="question-action-btn" onclick="quizBuilder.duplicateQuestion('${question.id}')" title="NhÃ¢n báº£n">
                                        ð
                                    </button>
                                    <button class="question-action-btn" onclick="quizBuilder.deleteQuestion('${question.id}')" title="XÃ³a">
                                        ðï¸
                                    </button>
                                </div>
                            </div>
                            
                            ${isEditing ? this.renderQuestionForm(question) : this.renderQuestionPreview(question)}
                        </div>
                    `;
                }).join('');

                container.innerHTML = questionsHTML;
            }

            renderQuestionForm(question) {
                return `
                    <div class="question-form">
                        <div class="question-type-selector">
                            <button class="type-btn ${question.type === 'radio' ? 'active' : ''}" onclick="quizBuilder.changeQuestionType('${question.id}', 'radio')">
                                ð» Má»t ÄÃ¡p Ã¡n
                            </button>
                            <button class="type-btn ${question.type === 'checkbox' ? 'active' : ''}" onclick="quizBuilder.changeQuestionType('${question.id}', 'checkbox')">
                                âï¸ Nhiá»u ÄÃ¡p Ã¡n
                            </button>
                            <button class="type-btn ${question.type === 'text' ? 'active' : ''}" onclick="quizBuilder.changeQuestionType('${question.id}', 'text')">
                                ð Tá»± luáº­n
                            </button>
                        </div>
                        
                        <div class="question-content">
                            <div class="form-group">
                                <label class="form-label">Ná»i dung cÃ¢u há»i *</label>
                                <textarea 
                                    class="form-control question-text-area" 
                                    placeholder="Nháº­p ná»i dung cÃ¢u há»i..."
                                    onchange="quizBuilder.updateQuestion('${question.id}', 'question', this.value)"
                                >${question.question}</textarea>
                            </div>
                            
                            ${question.type !== 'text' ? this.renderOptionsForm(question) : ''}
                            
                            <div class="form-group" style="max-width: 200px;">
                                <label class="form-label">Äiá»m sá»</label>
                                <input 
                                    type="number" 
                                    class="form-control" 
                                    value="${question.points}" 
                                    min="1" 
                                    max="100"
                                    onchange="quizBuilder.updateQuestion('${question.id}', 'points', parseInt(this.value))"
                                >
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-md);">
                            <button class="btn btn-primary" onclick="quizBuilder.saveQuestion('${question.id}')">
                                ð¾ LÆ°u cÃ¢u há»i
                            </button>
                            <button class="btn btn-secondary" onclick="quizBuilder.cancelEdit()">
                                â Há»§y
                            </button>
                        </div>
                    </div>
                `;
            }

            renderOptionsForm(question) {
                const isMultiple = question.type === 'checkbox';
                
                return `
                    <div class="options-container">
                        <div class="options-title">
                            ${isMultiple ? 'âï¸ CÃ¡c ÄÃ¡p Ã¡n (cÃ³ thá» chá»n nhiá»u ÄÃ¡p Ã¡n ÄÃºng)' : 'ð» CÃ¡c ÄÃ¡p Ã¡n (chá»n 1 ÄÃ¡p Ã¡n ÄÃºng)'}
                        </div>
                        
                        ${question.options.map((option, index) => `
                            <div class="option-item ${option.correct ? 'correct' : ''}">
                                <input 
                                    type="${isMultiple ? 'checkbox' : 'radio'}" 
                                    name="correct-${question.id}" 
                                    class="option-checkbox"
                                    ${option.correct ? 'checked' : ''}
                                    onchange="quizBuilder.updateOptionCorrect('${question.id}', ${index}, this.checked, '${question.type}')"
                                >
                                <input 
                                    type="text" 
                                    class="option-input" 
                                    value="${option.text}" 
                                    placeholder="Nháº­p ÄÃ¡p Ã¡n..."
                                    onchange="quizBuilder.updateOption('${question.id}', ${index}, this.value)"
                                >
                                <div class="option-actions">
                                    <button class="option-action-btn correct" onclick="quizBuilder.toggleOptionCorrect('${question.id}', ${index})" title="ÄÃ¡p Ã¡n ÄÃºng">
                                        â
                                    </button>
                                    <button class="option-action-btn" onclick="quizBuilder.deleteOption('${question.id}', ${index})" title="XÃ³a ÄÃ¡p Ã¡n" ${question.options.length <= 2 ? 'disabled' : ''}>
                                        ðï¸
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                        
                        <button class="add-option-btn" onclick="quizBuilder.addOption('${question.id}')" ${question.options.length >= 6 ? 'disabled' : ''}>
                            â ThÃªm ÄÃ¡p Ã¡n
                        </button>
                    </div>
                `;
            }

            renderQuestionPreview(question) {
                return `
                    <div class="question-preview">
                        <div class="preview-title">ðï¸ Xem trÆ°á»c</div>
                        <div class="preview-question">${question.question || '<em>ChÆ°a cÃ³ ná»i dung cÃ¢u há»i</em>'}</div>
                        
                        ${question.type !== 'text' ? `
                            <div class="preview-options">
                                ${question.options.map(option => `
                                    <div class="preview-option ${option.correct ? 'correct' : ''}">
                                        <input type="${question.type}" disabled ${option.correct ? 'checked' : ''}>
                                        <span>${option.text || '<em>ChÆ°a cÃ³ ná»i dung ÄÃ¡p Ã¡n</em>'}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<p><em>CÃ¢u há»i tá»± luáº­n - há»c viÃªn sáº½ nháº­p cÃ¢u tráº£ lá»i</em></p>'}
                    </div>
                `;
            }

            editQuestion(questionId) {
                this.editingQuestionId = questionId;
                this.renderQuestions();
            }

            saveQuestion(questionId) {
                const question = this.quiz.questions.find(q => q.id === questionId);
                if (!question) return;

                // Validate question
                if (!question.question.trim()) {
                    uiManager.showToast('Vui lÃ²ng nháº­p ná»i dung cÃ¢u há»i', 'warning');
                    return;
                }

                if (question.type !== 'text') {
                    const hasValidOptions = question.options.some(opt => opt.text.trim());
                    const hasCorrectAnswer = question.options.some(opt => opt.correct);

                    if (!hasValidOptions) {
                        uiManager.showToast('Vui lÃ²ng nháº­p Ã­t nháº¥t má»t ÄÃ¡p Ã¡n', 'warning');
                        return;
                    }

                    if (!hasCorrectAnswer) {
                        uiManager.showToast('Vui lÃ²ng chá»n Ã­t nháº¥t má»t ÄÃ¡p Ã¡n ÄÃºng', 'warning');
                        return;
                    }
                }

                this.editingQuestionId = null;
                this.renderQuestions();
                uiManager.showToast('ÄÃ£ lÆ°u cÃ¢u há»i', 'success');
            }

            cancelEdit() {
                this.editingQuestionId = null;
                this.renderQuestions();
            }

            updateQuestion(questionId, field, value) {
                const question = this.quiz.questions.find(q => q.id === questionId);
                if (question) {
                    question[field] = value;
                }
            }

            changeQuestionType(questionId, newType) {
                const question = this.quiz.questions.find(q => q.id === questionId);
                if (!question) return;

                question.type = newType;
                
                if (newType === 'text') {
                    question.options = [];
                } else if (question.options.length === 0) {
                    question.options = [
                        { text: '', correct: false },
                        { text: '', correct: false }
                    ];
                }

                // If changing from checkbox to radio, ensure only one correct answer
                if (newType === 'radio') {
                    let foundCorrect = false;
                    question.options.forEach(option => {
                        if (option.correct && foundCorrect) {
                            option.correct = false;
                        } else if (option.correct) {
                            foundCorrect = true;
                        }
                    });
                }

                this.renderQuestions();
            }

            updateOption(questionId, optionIndex, text) {
                const question = this.quiz.questions.find(q => q.id === questionId);
                if (question && question.options[optionIndex]) {
                    question.options[optionIndex].text = text;
                }
            }

            updateOptionCorrect(questionId, optionIndex, isCorrect, questionType) {
                const question = this.quiz.questions.find(q => q.id === questionId);
                if (!question || !question.options[optionIndex]) return;

                if (questionType === 'radio' && isCorrect) {
                    // For radio, only one option can be correct
                    question.options.forEach((option, index) => {
                        option.correct = index === optionIndex;
                    });
                } else {
                    question.options[optionIndex].correct = isCorrect;
                }

                this.renderQuestions();
            }

            toggleOptionCorrect(questionId, optionIndex) {
                const question = this.quiz.questions.find(q => q.id === questionId);
                if (!question || !question.options[optionIndex]) return;

                const option = question.options[optionIndex];
                const newCorrect = !option.correct;

                if (question.type === 'radio' && newCorrect) {
                    // For radio, only one option can be correct
                    question.options.forEach((opt, index) => {
                        opt.correct = index === optionIndex;
                    });
                } else {
                    option.correct = newCorrect;
                }

                this.renderQuestions();
            }

            addOption(questionId) {
                const question = this.quiz.questions.find(q => q.id === questionId);
                if (question && question.options.length < 6) {
                    question.options.push({ text: '', correct: false });
                    this.renderQuestions();
                }
            }

            deleteOption(questionId, optionIndex) {
                const question = this.quiz.questions.find(q => q.id === questionId);
                if (question && question.options.length > 2) {
                    question.options.splice(optionIndex, 1);
                    this.renderQuestions();
                }
            }

            moveQuestionUp(index) {
                if (index > 0) {
                    [this.quiz.questions[index], this.quiz.questions[index - 1]] = 
                    [this.quiz.questions[index - 1], this.quiz.questions[index]];
                    this.renderQuestions();
                }
            }

            moveQuestionDown(index) {
                if (index < this.quiz.questions.length - 1) {
                    [this.quiz.questions[index], this.quiz.questions[index + 1]] = 
                    [this.quiz.questions[index + 1], this.quiz.questions[index]];
                    this.renderQuestions();
                }
            }

            duplicateQuestion(questionId) {
                const question = this.quiz.questions.find(q => q.id === questionId);
                if (!question) return;

                this.questionCounter++;
                const newQuestion = {
                    ...JSON.parse(JSON.stringify(question)),
                    id: `q_${this.questionCounter}`
                };

                const index = this.quiz.questions.findIndex(q => q.id === questionId);
                this.quiz.questions.splice(index + 1, 0, newQuestion);
                
                this.renderQuestions();
                this.updateProgress();
                uiManager.showToast('ÄÃ£ nhÃ¢n báº£n cÃ¢u há»i', 'success');
            }

            deleteQuestion(questionId) {
                const question = this.quiz.questions.find(q => q.id === questionId);
                if (!question) return;

                uiManager.showConfirm(
                    'Báº¡n cÃ³ cháº¯c muá»n xÃ³a cÃ¢u há»i nÃ y?',
                    () => {
                        this.quiz.questions = this.quiz.questions.filter(q => q.id !== questionId);
                        this.renderQuestions();
                        this.updateProgress();
                        uiManager.showToast('ÄÃ£ xÃ³a cÃ¢u há»i', 'success');
                    }
                );
            }

            useTemplate(templateType) {
                let templateQuestions = [];

                switch (templateType) {
                    case 'basic':
                        templateQuestions = this.getBasicTemplate();
                        break;
                    case 'mixed':
                        templateQuestions = this.getMixedTemplate();
                        break;
                    case 'advanced':
                        templateQuestions = this.getAdvancedTemplate();
                        break;
                }

                if (templateQuestions.length > 0) {
                    uiManager.showConfirm(
                        `Sá»­ dá»¥ng template sáº½ thay tháº¿ táº¥t cáº£ cÃ¢u há»i hiá»n táº¡i. Báº¡n cÃ³ cháº¯c cháº¯n?`,
                        () => {
                            this.quiz.questions = templateQuestions;
                            this.questionCounter = templateQuestions.length;
                            this.renderQuestions();
                            this.updateProgress();
                            uiManager.showToast(`ÄÃ£ Ã¡p dá»¥ng template ${templateType}`, 'success');
                        }
                    );
                }
            }

            getBasicTemplate() {
                return [
                    {
                        id: 'template_q1',
                        type: 'radio',
                        question: 'CÃ¢u há»i máº«u 1: ÄÃ¢y lÃ  cÃ¢u há»i tráº¯c nghiá»m má»t ÄÃ¡p Ã¡n?',
                        options: [
                            { text: 'ÄÃ¡p Ã¡n A', correct: false },
                            { text: 'ÄÃ¡p Ã¡n B', correct: true },
                            { text: 'ÄÃ¡p Ã¡n C', correct: false },
                            { text: 'ÄÃ¡p Ã¡n D', correct: false }
                        ],
                        points: 10
                    },
                    {
                        id: 'template_q2',
                        type: 'checkbox',
                        question: 'CÃ¢u há»i máº«u 2: ÄÃ¢y lÃ  cÃ¢u há»i nhiá»u ÄÃ¡p Ã¡n?',
                        options: [
                            { text: 'ÄÃ¡p Ã¡n A', correct: true },
                            { text: 'ÄÃ¡p Ã¡n B', correct: false },
                            { text: 'ÄÃ¡p Ã¡n C', correct: true },
                            { text: 'ÄÃ¡p Ã¡n D', correct: false }
                        ],
                        points: 10
                    }
                ];
            }

            getMixedTemplate() {
                return [
                    ...this.getBasicTemplate(),
                    {
                        id: 'template_q3',
                        type: 'text',
                        question: 'CÃ¢u há»i máº«u 3: ÄÃ¢y lÃ  cÃ¢u há»i tá»± luáº­n?',
                        options: [],
                        points: 20
                    }
                ];
            }

            getAdvancedTemplate() {
                const basic = this.getBasicTemplate();
                const questions = [];
                
                for (let i = 0; i < 10; i++) {
                    const template = basic[i % basic.length];
                    questions.push({
                        ...JSON.parse(JSON.stringify(template)),
                        id: `template_q${i + 1}`,
                        question: `CÃ¢u há»i ${i + 1}: ${template.question}`
                    });
                }
                
                return questions;
            }

            importFromExcel() {
                this.showImportExcelModal();
            }

            showImportExcelModal() {
                const modalHtml = `
                    <div class="modal-overlay" id="importExcelModal">
                        <div class="modal-container" style="max-width: 600px;">
                            <div class="modal-header">
                                <h3>ð Import cÃ¢u há»i tá»« Excel</h3>
                                <button class="modal-close" onclick="document.getElementById('importExcelModal').remove()">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label class="form-label">ð Chá»n file Excel</label>
                                    <input type="file" accept=".xlsx,.xls" class="form-control" id="excelFileInput">
                                    <small class="form-help">Há» trá»£ Äá»nh dáº¡ng: .xlsx, .xls</small>
                                </div>
                                
                                <div class="import-template">
                                    <h4>ð Template Excel máº«u:</h4>
                                    <div class="template-preview">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Question</th>
                                                    <th>Type</th>
                                                    <th>Option A</th>
                                                    <th>Option B</th>
                                                    <th>Option C</th>
                                                    <th>Option D</th>
                                                    <th>Correct</th>
                                                    <th>Explanation</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>JavaScript lÃ  gÃ¬?</td>
                                                    <td>multiple-choice</td>
                                                    <td>NgÃ´n ngá»¯ láº­p trÃ¬nh</td>
                                                    <td>Framework</td>
                                                    <td>Database</td>
                                                    <td>Há» Äiá»u hÃ nh</td>
                                                    <td>A</td>
                                                    <td>JS lÃ  ngÃ´n ngá»¯ láº­p trÃ¬nh</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <button class="btn btn-secondary" onclick="quizBuilder.downloadTemplate()">
                                        ð¥ Táº£i template máº«u
                                    </button>
                                </div>

                                <div class="import-options">
                                    <h4>âï¸ TÃ¹y chá»n import:</h4>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked> Ghi ÄÃ¨ cÃ¢u há»i hiá»n táº¡i
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked> Tá»± Äá»ng ÄÃ¡nh sá» cÃ¢u há»i
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox"> Bá» qua cÃ¢u há»i lá»i
                                    </label>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-secondary" onclick="document.getElementById('importExcelModal').remove()">
                                    Há»§y
                                </button>
                                <button class="btn btn-primary" onclick="quizBuilder.processExcelImport()">
                                    ð Import cÃ¢u há»i
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            }

            downloadTemplate() {
                // Mock download template
                const csvContent = "Question,Type,Option A,Option B,Option C,Option D,Correct,Explanation\n" +
                    "JavaScript lÃ  gÃ¬?,multiple-choice,NgÃ´n ngá»¯ láº­p trÃ¬nh,Framework,Database,Há» Äiá»u hÃ nh,A,JS lÃ  ngÃ´n ngá»¯ láº­p trÃ¬nh\n" +
                    "HTML viáº¿t táº¯t cá»§a gÃ¬?,multiple-choice,HyperText Markup Language,Home Tool Markup Language,Hyperlinks Text Mark Language,None,A,HTML lÃ  HyperText Markup Language";
                
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'quiz-template.csv';
                a.click();
                window.URL.revokeObjectURL(url);
                
                uiManager.showToast('ÄÃ£ táº£i template máº«u', 'success');
            }

            processExcelImport() {
                const fileInput = document.getElementById('excelFileInput');
                
                if (!fileInput.files[0]) {
                    uiManager.showToast('Vui lÃ²ng chá»n file Excel', 'error');
                    return;
                }
                
                // Mock processing
                uiManager.showToast('Äang xá»­ lÃ½ file Excel...', 'info');
                
                setTimeout(() => {
                    // Mock imported questions
                    const importedQuestions = [
                        {
                            question: "JavaScript ÄÆ°á»£c phÃ¡t triá»n bá»i ai?",
                            type: "multiple-choice",
                            options: ["Brendan Eich", "Tim Berners-Lee", "James Gosling", "Anders Hejlsberg"],
                            correctAnswer: 0,
                            explanation: "JavaScript ÄÆ°á»£c táº¡o ra bá»i Brendan Eich táº¡i Netscape"
                        },
                        {
                            question: "CSS viáº¿t táº¯t cá»§a gÃ¬?",
                            type: "multiple-choice",
                            options: ["Cascading Style Sheets", "Computer Style Sheets", "Creative Style Sheets", "Colorful Style Sheets"],
                            correctAnswer: 0,
                            explanation: "CSS lÃ  Cascading Style Sheets"
                        }
                    ];
                    
                    // Add to current questions
                    this.quiz.questions.push(...importedQuestions);
                    this.renderQuestions();
                    
                    document.getElementById('importExcelModal').remove();
                    uiManager.showToast(`ÄÃ£ import thÃ nh cÃ´ng ${importedQuestions.length} cÃ¢u há»i`, 'success');
                }, 2000);
            }

            previewQuiz() {
                if (!this.validateQuiz()) {
                    return;
                }

                const previewContainer = document.getElementById('previewQuiz');
                const course = this.courses.find(c => c.courseId === this.quiz.courseId);
                
                previewContainer.innerHTML = `
                    <div class="preview-quiz-header">
                        <div class="preview-quiz-title">${this.quiz.title}</div>
                        <div class="preview-quiz-meta">
                            <span>ð ${course ? course.title : 'KhÃ³a há»c'}</span>
                            <span>â±ï¸ ${this.quiz.duration} phÃºt</span>
                            <span>â ${this.quiz.questions.length} cÃ¢u há»i</span>
                            <span>ð¯ ${this.quiz.maxScore} Äiá»m</span>
                        </div>
                    </div>
                    
                    ${this.quiz.description ? `<p style="margin-bottom: var(--spacing-lg); color: #666;">${this.quiz.description}</p>` : ''}
                    
                    ${this.quiz.questions.map((question, index) => `
                        <div class="preview-question-item">
                            <div class="preview-question-number">CÃ¢u ${index + 1} (${question.points} Äiá»m):</div>
                            <div style="margin-bottom: var(--spacing-md); font-weight: 500;">${question.question}</div>
                            
                            ${question.type === 'text' ? 
                                '<p><em>CÃ¢u há»i tá»± luáº­n - há»c viÃªn sáº½ nháº­p cÃ¢u tráº£ lá»i</em></p>' :
                                `<div class="preview-options">
                                    ${question.options.map((option, optIndex) => `
                                        <div class="preview-option ${option.correct ? 'correct' : ''}">
                                            <input type="${question.type}" name="preview_q${index}" disabled ${option.correct ? 'checked' : ''}>
                                            <span>${String.fromCharCode(65 + optIndex)}. ${option.text}</span>
                                            ${option.correct ? '<span style="color: var(--accent-green); margin-left: auto;">â</span>' : ''}
                                        </div>
                                    `).join('')}
                                </div>`
                            }
                        </div>
                    `).join('')}
                `;

                uiManager.showModal('previewModal');
            }

            validateQuiz() {
                if (!this.quiz.title.trim()) {
                    uiManager.showToast('Vui lÃ²ng nháº­p tÃªn quiz', 'warning');
                    return false;
                }

                if (!this.quiz.courseId) {
                    uiManager.showToast('Vui lÃ²ng chá»n khÃ³a há»c', 'warning');
                    return false;
                }

                if (this.quiz.questions.length === 0) {
                    uiManager.showToast('Vui lÃ²ng thÃªm Ã­t nháº¥t má»t cÃ¢u há»i', 'warning');
                    return false;
                }

                // Validate each question
                for (let i = 0; i < this.quiz.questions.length; i++) {
                    const question = this.quiz.questions[i];
                    
                    if (!question.question.trim()) {
                        uiManager.showToast(`CÃ¢u há»i ${i + 1} chÆ°a cÃ³ ná»i dung`, 'warning');
                        return false;
                    }

                    if (question.type !== 'text') {
                        const hasValidOptions = question.options.some(opt => opt.text.trim());
                        const hasCorrectAnswer = question.options.some(opt => opt.correct);

                        if (!hasValidOptions) {
                            uiManager.showToast(`CÃ¢u há»i ${i + 1} chÆ°a cÃ³ ÄÃ¡p Ã¡n`, 'warning');
                            return false;
                        }

                        if (!hasCorrectAnswer) {
                            uiManager.showToast(`CÃ¢u há»i ${i + 1} chÆ°a cÃ³ ÄÃ¡p Ã¡n ÄÃºng`, 'warning');
                            return false;
                        }
                    }
                }

                return true;
            }

            saveAsDraft() {
                if (!this.quiz.title.trim()) {
                    uiManager.showToast('Vui lÃ²ng nháº­p tÃªn quiz Äá» lÆ°u nhÃ¡p', 'warning');
                    return;
                }

                this.updateQuizData();
                
                // Mock save as draft
                uiManager.showToast('ÄÃ£ lÆ°u quiz dÆ°á»i dáº¡ng nhÃ¡p', 'success');
                
                // Log activity
                authManager.logActivity('Quiz Draft Saved', `Saved draft: ${this.quiz.title}`);
            }

            publishQuiz() {
                if (!this.validateQuiz()) {
                    return;
                }

                this.updateQuizData();

                uiManager.showConfirm(
                    'Báº¡n cÃ³ cháº¯c muá»n xuáº¥t báº£n quiz nÃ y? Sau khi xuáº¥t báº£n, há»c viÃªn cÃ³ thá» ÄÄng kÃ½ vÃ  lÃ m bÃ i.',
                    () => {
                        // Mock publish
                        uiManager.showToast('Quiz ÄÃ£ ÄÆ°á»£c xuáº¥t báº£n thÃ nh cÃ´ng!', 'success');
                        
                        // Log activity
                        authManager.logActivity('Quiz Published', `Published quiz: ${this.quiz.title}`);
                        
                        // Redirect to quiz list
                        setTimeout(() => {
                            window.location.href = 'quizzes.html';
                        }, 2000);
                    }
                );
            }

            autoSave() {
                if (this.quiz.title.trim() && this.quiz.questions.length > 0) {
                    this.updateQuizData();
                    console.log('Auto-saved quiz:', this.quiz.title);
                }
            }
        }

        // Initialize quiz builder when DOM is loaded
        let quizBuilder;
        document.addEventListener('DOMContentLoaded', () => {
            quizBuilder = new QuizBuilder();
        });
    </script>
</body>
</html> 
