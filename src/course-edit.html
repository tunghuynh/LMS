<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch·ªânh s·ª≠a Kh√≥a h·ªçc - E-Learning Platform</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    
    <style>

        
        .course-edit-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: var(--spacing-lg);
        }

        .course-edit-header {
            background: var(--white);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-light);
            margin-bottom: var(--spacing-lg);
        }

        .course-edit-title {
            font-size: var(--font-size-h1);
            color: var(--dark-gray);
            margin-bottom: var(--spacing-sm);
        }

        .course-edit-tabs {
            display: flex;
            background: var(--white);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-light);
        }

        .tab-btn {
            flex: 1;
            padding: var(--spacing-md);
            background: none;
            border: none;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #666;
        }

        .tab-btn.active {
            background: var(--primary-blue);
            color: var(--white);
        }

        .tab-btn:hover:not(.active) {
            background: var(--light-gray);
        }

        .tab-content {
            display: none;
            background: var(--white);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-light);
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-xl);
        }

        .form-section {
            margin-bottom: var(--spacing-xl);
        }

        .form-section h3 {
            color: var(--dark-gray);
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--border-color);
        }

        .thumbnail-upload {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius-md);
            padding: var(--spacing-xl);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .thumbnail-upload:hover {
            border-color: var(--primary-blue);
            background: rgba(44, 110, 170, 0.05);
        }

        .thumbnail-upload.has-image {
            border-style: solid;
            padding: 0;
            overflow: hidden;
        }

        .thumbnail-preview {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: var(--border-radius-md);
        }

        .upload-placeholder {
            color: #666;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        /* Lesson Management */
        .lessons-container {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }

        .lessons-header {
            background: var(--light-gray);
            padding: var(--spacing-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .lesson-item {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .lesson-item:last-child {
            border-bottom: none;
        }

        .lesson-handle {
            cursor: move;
            color: #999;
            font-size: 1.2rem;
        }

        .lesson-info {
            flex: 1;
        }

        .lesson-title {
            font-weight: 600;
            margin-bottom: var(--spacing-xs);
        }

        .lesson-meta {
            font-size: var(--font-size-small);
            color: #666;
        }

        .lesson-actions {
            display: flex;
            gap: var(--spacing-sm);
        }

        /* Lesson Modal */
        .lesson-form {
            display: grid;
            gap: var(--spacing-md);
        }

        .content-type-selector {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .content-type-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-md);
            background: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .content-type-btn.active {
            border-color: var(--primary-blue);
            background: rgba(44, 110, 170, 0.1);
            color: var(--primary-blue);
        }

        .content-editor {
            display: none;
        }

        .content-editor.active {
            display: block;
        }

        /* Course Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }

        .setting-card {
            background: var(--light-gray);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
        }

        .setting-card h4 {
            margin-bottom: var(--spacing-md);
            color: var(--dark-gray);
        }

        /* Preview */
        .course-preview {
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }

        .preview-header {
            background: var(--primary-blue);
            color: var(--white);
            padding: var(--spacing-lg);
            text-align: center;
        }

        .preview-body {
            padding: var(--spacing-lg);
        }

        /* Action Buttons */
        .action-buttons {
            position: sticky;
            bottom: 0;
            background: var(--white);
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }

            .course-edit-tabs {
                flex-direction: column;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="hamburger" id="hamburgerBtn">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="header-logo">üìö EduPlatform</div>
        </div>
        <div class="header-right">
            <div class="header-user" id="userInfo">
                <div class="header-avatar" id="userAvatar">T</div>
                <div class="header-user-info">
                    <span class="header-username" id="userName">Teacher</span>
                    <span class="header-role" id="userRole">Gi·∫£ng vi√™n</span>
                </div>
            </div>
            <button class="theme-toggle" onclick="window.themeManager?.toggleTheme()" title="Chuy·ªÉn ƒë·ªïi giao di·ªán">
                <span class="theme-icon">üåô</span>
            </button>
            <button class="btn btn-secondary btn-small" onclick="authManager.logout()">
                ƒêƒÉng xu·∫•t
            </button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Sidebar -->
        <div class="sidebar sidebar-fixed" id="sidebar">
            <div class="sidebar-nav" id="sidebarNav">
                <!-- Menu will be populated by CommonMenuManager -->
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <div class="course-edit-container">
                <!-- Header -->
                <div class="course-edit-header">
                    <h1 class="course-edit-title" id="pageTitle">üìù T·∫°o kh√≥a h·ªçc m·ªõi</h1>
                    <p style="color: #666;">T·∫°o v√† qu·∫£n l√Ω n·ªôi dung kh√≥a h·ªçc c·ªßa b·∫°n m·ªôt c√°ch d·ªÖ d√†ng.</p>
                </div>

                <!-- Tabs -->
                <div class="course-edit-tabs">
                    <button class="tab-btn active" onclick="courseEditor.showTab('basic')">
                        üìù Th√¥ng tin c∆° b·∫£n
                    </button>
                    <button class="tab-btn" onclick="courseEditor.showTab('content')">
                        üìö N·ªôi dung b√†i h·ªçc
                    </button>
                    <button class="tab-btn" onclick="courseEditor.showTab('settings')">
                        ‚öôÔ∏è C√†i ƒë·∫∑t
                    </button>
                    <button class="tab-btn" onclick="courseEditor.showTab('preview')">
                        üëÅÔ∏è Xem tr∆∞·ªõc
                    </button>
                </div>

                <!-- Basic Info Tab -->
                <div id="basicContent" class="tab-content active">
                    <div class="form-grid">
                        <div class="main-form">
                            <div class="form-section">
                                <h3>üìù Th√¥ng tin kh√≥a h·ªçc</h3>
                                <div class="form-group">
                                    <label class="form-label">T√™n kh√≥a h·ªçc *</label>
                                    <input type="text" id="courseTitle" class="form-control" 
                                           placeholder="Nh·∫≠p t√™n kh√≥a h·ªçc..." required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">M√¥ t·∫£ ng·∫Øn</label>
                                    <textarea id="courseDescription" class="form-control" rows="4"
                                              placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ kh√≥a h·ªçc..."></textarea>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">M√¥ t·∫£ chi ti·∫øt</label>
                                    <textarea id="courseDetailedDescription" class="form-control" rows="8"
                                              placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ n·ªôi dung, m·ª•c ti√™u h·ªçc t·∫≠p..."></textarea>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Danh m·ª•c *</label>
                                        <select id="courseCategory" class="form-control" required>
                                            <!-- Categories will be loaded -->
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">ƒê·ªô kh√≥</label>
                                        <select id="courseDifficulty" class="form-control">
                                            <option value="beginner">C∆° b·∫£n</option>
                                            <option value="intermediate">Trung c·∫•p</option>
                                            <option value="advanced">N√¢ng cao</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label">Th·ªùi l∆∞·ª£ng (gi·ªù)</label>
                                        <input type="number" id="courseDuration" class="form-control" min="1" value="10">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Ng√¥n ng·ªØ</label>
                                        <select id="courseLanguage" class="form-control">
                                            <option value="vi">Ti·∫øng Vi·ªát</option>
                                            <option value="en">English</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sidebar-form">
                            <div class="form-section">
                                <h3>üñºÔ∏è H√¨nh ·∫£nh kh√≥a h·ªçc</h3>
                                <div class="thumbnail-upload" id="thumbnailUpload" onclick="courseEditor.uploadThumbnail()">
                                    <div class="upload-placeholder">
                                        <div class="upload-icon">üì∑</div>
                                        <p>Nh·∫•p ƒë·ªÉ t·∫£i l√™n h√¨nh ·∫£nh</p>
                                        <p style="font-size: var(--font-size-small); color: #999;">JPG, PNG t·ªëi ƒëa 2MB</p>
                                    </div>
                                </div>
                                <input type="file" id="thumbnailInput" accept="image/*" style="display: none;" onchange="courseEditor.handleThumbnailUpload(event)">
                            </div>

                            <div class="form-section">
                                <h3>üéØ M·ª•c ti√™u h·ªçc t·∫≠p</h3>
                                <div id="learningObjectives">
                                    <div class="form-group">
                                        <input type="text" class="form-control" placeholder="M·ª•c ti√™u 1...">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-outline btn-small" onclick="courseEditor.addObjective()">
                                    ‚ûï Th√™m m·ª•c ti√™u
                                </button>
                            </div>

                            <div class="form-section">
                                <h3>üìã Y√™u c·∫ßu tr∆∞·ªõc</h3>
                                <div id="prerequisites">
                                    <div class="form-group">
                                        <input type="text" class="form-control" placeholder="Y√™u c·∫ßu 1...">
                                    </div>
                                </div>
                                <button type="button" class="btn btn-outline btn-small" onclick="courseEditor.addPrerequisite()">
                                    ‚ûï Th√™m y√™u c·∫ßu
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Tab -->
                <div id="contentContent" class="tab-content">
                    <div class="form-section">
                        <h3>üìö Qu·∫£n l√Ω b√†i h·ªçc</h3>
                        <div class="lessons-container">
                            <div class="lessons-header">
                                <span>Danh s√°ch b√†i h·ªçc</span>
                                <button class="btn btn-primary btn-small" onclick="courseEditor.showLessonModal()">
                                    ‚ûï Th√™m b√†i h·ªçc
                                </button>
                            </div>
                            <div id="lessonsList">
                                <!-- Lessons will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsContent" class="tab-content">
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h4>üîí Quy·ªÅn truy c·∫≠p</h4>
                            <div class="form-group">
                                <label class="form-label">Tr·∫°ng th√°i</label>
                                <select id="courseStatus" class="form-control">
                                    <option value="draft">B·∫£n nh√°p</option>
                                    <option value="published">ƒê√£ xu·∫•t b·∫£n</option>
                                    <option value="archived">L∆∞u tr·ªØ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="coursePublic">
                                    Kh√≥a h·ªçc c√¥ng khai
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="courseFeatured">
                                    Kh√≥a h·ªçc n·ªïi b·∫≠t
                                </label>
                            </div>
                        </div>

                        <div class="setting-card">
                            <h4>üí∞ Gi√° c·∫£</h4>
                            <div class="form-group">
                                <label class="form-label">Lo·∫°i kh√≥a h·ªçc</label>
                                <select id="courseType" class="form-control">
                                    <option value="free">Mi·ªÖn ph√≠</option>
                                    <option value="paid">C√≥ ph√≠</option>
                                </select>
                            </div>
                            <div class="form-group" id="priceGroup" style="display: none;">
                                <label class="form-label">Gi√° (VNƒê)</label>
                                <input type="number" id="coursePrice" class="form-control" min="0">
                            </div>
                        </div>

                        <div class="setting-card">
                            <h4>üìÖ Th·ªùi gian</h4>
                            <div class="form-group">
                                <label class="form-label">Ng√†y b·∫Øt ƒë·∫ßu</label>
                                <input type="date" id="courseStartDate" class="form-control">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ng√†y k·∫øt th√∫c</label>
                                <input type="date" id="courseEndDate" class="form-control">
                            </div>
                        </div>

                        <div class="setting-card">
                            <h4>üë• H·ªçc vi√™n</h4>
                            <div class="form-group">
                                <label class="form-label">S·ªë l∆∞·ª£ng t·ªëi ƒëa</label>
                                <input type="number" id="maxStudents" class="form-control" min="1" value="100">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="autoEnroll">
                                    T·ª± ƒë·ªông duy·ªát ƒëƒÉng k√Ω
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview Tab -->
                <div id="previewContent" class="tab-content">
                    <div class="course-preview">
                        <div class="preview-header">
                            <h2 id="previewTitle">T√™n kh√≥a h·ªçc</h2>
                            <p id="previewDescription">M√¥ t·∫£ kh√≥a h·ªçc</p>
                        </div>
                        <div class="preview-body">
                            <div id="previewDetails">
                                <!-- Preview content will be generated -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="window.history.back()">
                        ‚Üê Quay l·∫°i
                    </button>
                    <button class="btn btn-outline" onclick="courseEditor.saveDraft()">
                        üíæ L∆∞u nh√°p
                    </button>
                    <button class="btn btn-primary" onclick="courseEditor.saveCourse()">
                        ‚úÖ L∆∞u kh√≥a h·ªçc
                    </button>
                    <button class="btn btn-accent" onclick="courseEditor.publishCourse()">
                        üöÄ Xu·∫•t b·∫£n
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer" id="footer">
        <p>&copy; 2025 E-Learning Platform. Ph√°t tri·ªÉn b·ªüi <strong>T√πng Huynh</strong> üé®üíª</p>
    </footer>

    <!-- Lesson Modal -->
    <div class="modal" id="lessonModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="lessonModalTitle">‚ûï Th√™m b√†i h·ªçc m·ªõi</h3>
                <button class="modal-close" onclick="uiManager.hideModal('lessonModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form class="lesson-form" id="lessonForm">
                    <div class="form-group">
                        <label class="form-label">T√™n b√†i h·ªçc *</label>
                        <input type="text" id="lessonTitle" class="form-control" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Lo·∫°i n·ªôi dung</label>
                        <div class="content-type-selector">
                            <button type="button" class="content-type-btn active" onclick="courseEditor.selectContentType('video')">
                                üìπ Video
                            </button>
                            <button type="button" class="content-type-btn" onclick="courseEditor.selectContentType('text')">
                                üìù VƒÉn b·∫£n
                            </button>
                            <button type="button" class="content-type-btn" onclick="courseEditor.selectContentType('pdf')">
                                üìÑ PDF
                            </button>
                        </div>
                    </div>

                    <!-- Video Content -->
                    <div class="content-editor active" id="videoEditor">
                        <div class="form-group">
                            <label class="form-label">URL Video (YouTube)</label>
                            <input type="url" id="videoUrl" class="form-control" placeholder="https://www.youtube.com/watch?v=...">
                        </div>
                    </div>

                    <!-- Text Content -->
                    <div class="content-editor" id="textEditor">
                        <div class="form-group">
                            <label class="form-label">N·ªôi dung b√†i h·ªçc</label>
                            <textarea id="textContent" class="form-control" rows="10"></textarea>
                        </div>
                    </div>

                    <!-- PDF Content -->
                    <div class="content-editor" id="pdfEditor">
                        <div class="form-group">
                            <label class="form-label">File PDF</label>
                            <input type="file" id="pdfFile" class="form-control" accept=".pdf">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Th·ªùi l∆∞·ª£ng (ph√∫t)</label>
                        <input type="number" id="lessonDuration" class="form-control" min="1" value="30">
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="lessonRequired">
                            B√†i h·ªçc b·∫Øt bu·ªôc
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="uiManager.hideModal('lessonModal')">
                    H·ªßy
                </button>
                <button class="btn btn-primary" onclick="courseEditor.saveLesson()">
                    üíæ L∆∞u b√†i h·ªçc
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/components/menu-manager.js"></script>
    <script>
        class CourseEditor {
            constructor() {
                this.currentCourse = null;
                this.currentLesson = null;
                this.lessons = [];
                this.categories = [];
                this.selectedContentType = 'video';
                this.init();
            }

            init() {
                // Check authentication
                if (!authManager.isLoggedIn()) {
                    window.location.href = 'index.html';
                    return;
                }

                const currentUser = authManager.getCurrentUser();
                if (!['admin', 'teacher'].includes(currentUser.role)) {
                    uiManager.showToast('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang n√†y', 'error');
                    authManager.redirectToDashboard();
                    return;
                }

                this.loadCategories();
                this.setupEventListeners();
                this.loadCourseData();
            }

            loadCategories() {
                // Load categories from localStorage
                const categories = JSON.parse(localStorage.getItem('courseCategories') || '[]');
                const categorySelect = document.getElementById('courseCategory');
                
                categorySelect.innerHTML = '<option value="">Ch·ªçn danh m·ª•c</option>' +
                    categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');
            }

            setupEventListeners() {
                // Course type change
                document.getElementById('courseType').addEventListener('change', (e) => {
                    const priceGroup = document.getElementById('priceGroup');
                    priceGroup.style.display = e.target.value === 'paid' ? 'block' : 'none';
                });

                // Auto-update preview
                ['courseTitle', 'courseDescription'].forEach(id => {
                    document.getElementById(id).addEventListener('input', () => {
                        this.updatePreview();
                    });
                });
            }

            loadCourseData() {
                // Check if editing existing course
                const urlParams = new URLSearchParams(window.location.search);
                const courseId = urlParams.get('id');
                
                if (courseId) {
                    // Load existing course
                    this.loadExistingCourse(courseId);
                } else {
                    // Set default values for new course
                    this.setDefaultValues();
                }
            }

            loadExistingCourse(courseId) {
                // Load course data from localStorage or API
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                this.currentCourse = courses.find(c => c.courseId === courseId);
                
                if (this.currentCourse) {
                    document.getElementById('pageTitle').textContent = '‚úèÔ∏è Ch·ªânh s·ª≠a kh√≥a h·ªçc';
                    this.populateForm();
                } else {
                    uiManager.showToast('Kh√¥ng t√¨m th·∫•y kh√≥a h·ªçc', 'error');
                    window.location.href = 'courses.html';
                }
            }

            populateForm() {
                const course = this.currentCourse;
                
                document.getElementById('courseTitle').value = course.title || '';
                document.getElementById('courseDescription').value = course.description || '';
                document.getElementById('courseDetailedDescription').value = course.detailedDescription || '';
                document.getElementById('courseCategory').value = course.categoryId || '';
                document.getElementById('courseDifficulty').value = course.difficulty || 'beginner';
                document.getElementById('courseDuration').value = course.duration || 10;
                document.getElementById('courseLanguage').value = course.language || 'vi';
                
                // Load lessons
                this.lessons = course.lessons || [];
                this.renderLessons();
                
                this.updatePreview();
            }

            setDefaultValues() {
                const today = new Date().toISOString().split('T')[0];
                const nextMonth = new Date();
                nextMonth.setMonth(nextMonth.getMonth() + 1);
                
                document.getElementById('courseStartDate').value = today;
                document.getElementById('courseEndDate').value = nextMonth.toISOString().split('T')[0];
                document.getElementById('courseLanguage').value = 'vi';
                document.getElementById('courseDifficulty').value = 'beginner';
            }

            showTab(tabName) {
                // Hide all tab contents
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Remove active class from all tabs
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Show selected tab content
                document.getElementById(tabName + 'Content').classList.add('active');
                event.target.classList.add('active');
                
                // Update preview when showing preview tab
                if (tabName === 'preview') {
                    this.updatePreview();
                }
            }

            uploadThumbnail() {
                document.getElementById('thumbnailInput').click();
            }

            handleThumbnailUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    if (file.size > 2 * 1024 * 1024) {
                        uiManager.showToast('File qu√° l·ªõn. Vui l√≤ng ch·ªçn file nh·ªè h∆°n 2MB', 'error');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const uploadDiv = document.getElementById('thumbnailUpload');
                        uploadDiv.classList.add('has-image');
                        uploadDiv.innerHTML = `<img src="${e.target.result}" alt="Thumbnail" class="thumbnail-preview">`;
                        this.courseThumbnail = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            }

            addObjective() {
                const container = document.getElementById('learningObjectives');
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <input type="text" class="form-control" placeholder="M·ª•c ti√™u m·ªõi...">
                        <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.parentElement.remove()">
                            üóëÔ∏è
                        </button>
                    </div>
                `;
                container.appendChild(div);
            }

            addPrerequisite() {
                const container = document.getElementById('prerequisites');
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <div style="display: flex; gap: var(--spacing-sm);">
                        <input type="text" class="form-control" placeholder="Y√™u c·∫ßu m·ªõi...">
                        <button type="button" class="btn btn-danger btn-small" onclick="this.parentElement.parentElement.remove()">
                            üóëÔ∏è
                        </button>
                    </div>
                `;
                container.appendChild(div);
            }

            showLessonModal() {
                this.currentLesson = null;
                document.getElementById('lessonModalTitle').textContent = '‚ûï Th√™m b√†i h·ªçc m·ªõi';
                document.getElementById('lessonForm').reset();
                this.selectContentType('video');
                uiManager.showModal('lessonModal');
            }

            editLesson(index) {
                this.currentLesson = this.lessons[index];
                document.getElementById('lessonModalTitle').textContent = '‚úèÔ∏è Ch·ªânh s·ª≠a b√†i h·ªçc';
                
                document.getElementById('lessonTitle').value = this.currentLesson.title;
                document.getElementById('lessonDuration').value = this.currentLesson.duration;
                document.getElementById('lessonRequired').checked = this.currentLesson.required;
                
                this.selectContentType(this.currentLesson.type);
                
                if (this.currentLesson.type === 'video') {
                    document.getElementById('videoUrl').value = this.currentLesson.videoUrl || '';
                } else if (this.currentLesson.type === 'text') {
                    document.getElementById('textContent').value = this.currentLesson.content || '';
                }
                
                uiManager.showModal('lessonModal');
            }

            selectContentType(type) {
                this.selectedContentType = type;
                
                // Update buttons
                document.querySelectorAll('.content-type-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event?.target.classList.add('active');
                
                // Show appropriate editor
                document.querySelectorAll('.content-editor').forEach(editor => {
                    editor.classList.remove('active');
                });
                document.getElementById(type + 'Editor').classList.add('active');
            }

            saveLesson() {
                const title = document.getElementById('lessonTitle').value.trim();
                if (!title) {
                    uiManager.showToast('Vui l√≤ng nh·∫≠p t√™n b√†i h·ªçc', 'warning');
                    return;
                }

                const lessonData = {
                    title: title,
                    type: this.selectedContentType,
                    duration: parseInt(document.getElementById('lessonDuration').value),
                    required: document.getElementById('lessonRequired').checked
                };

                // Add content based on type
                if (this.selectedContentType === 'video') {
                    lessonData.videoUrl = document.getElementById('videoUrl').value;
                } else if (this.selectedContentType === 'text') {
                    lessonData.content = document.getElementById('textContent').value;
                } else if (this.selectedContentType === 'pdf') {
                    // Handle PDF file upload
                    const pdfFile = document.getElementById('pdfFile').files[0];
                    if (pdfFile) {
                        lessonData.pdfFileName = pdfFile.name;
                        // In real app, upload file to server
                    }
                }

                if (this.currentLesson) {
                    // Update existing lesson
                    const index = this.lessons.indexOf(this.currentLesson);
                    this.lessons[index] = { ...this.currentLesson, ...lessonData };
                } else {
                    // Add new lesson
                    lessonData.id = Date.now();
                    this.lessons.push(lessonData);
                }

                this.renderLessons();
                uiManager.hideModal('lessonModal');
                uiManager.showToast('ƒê√£ l∆∞u b√†i h·ªçc th√†nh c√¥ng!', 'success');
            }

            renderLessons() {
                const container = document.getElementById('lessonsList');
                
                if (this.lessons.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: var(--spacing-xl); color: #666;">
                            <div style="font-size: 2rem; margin-bottom: var(--spacing-md);">üìö</div>
                            <p>Ch∆∞a c√≥ b√†i h·ªçc n√†o. H√£y th√™m b√†i h·ªçc ƒë·∫ßu ti√™n!</p>
                        </div>
                    `;
                    return;
                }

                const lessonsHTML = this.lessons.map((lesson, index) => `
                    <div class="lesson-item">
                        <div class="lesson-handle">‚ãÆ‚ãÆ</div>
                        <div class="lesson-info">
                            <div class="lesson-title">${lesson.title}</div>
                            <div class="lesson-meta">
                                ${lesson.type === 'video' ? 'üìπ' : lesson.type === 'text' ? 'üìù' : 'üìÑ'} 
                                ${lesson.type} ‚Ä¢ ${lesson.duration} ph√∫t
                                ${lesson.required ? ' ‚Ä¢ B·∫Øt bu·ªôc' : ''}
                            </div>
                        </div>
                        <div class="lesson-actions">
                            <button class="btn btn-outline btn-small" onclick="courseEditor.editLesson(${index})">
                                ‚úèÔ∏è S·ª≠a
                            </button>
                            <button class="btn btn-danger btn-small" onclick="courseEditor.deleteLesson(${index})">
                                üóëÔ∏è X√≥a
                            </button>
                        </div>
                    </div>
                `).join('');

                container.innerHTML = lessonsHTML;
            }

            deleteLesson(index) {
                uiManager.showConfirm(
                    `B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b√†i h·ªçc "${this.lessons[index].title}"?`,
                    () => {
                        this.lessons.splice(index, 1);
                        this.renderLessons();
                        uiManager.showToast('ƒê√£ x√≥a b√†i h·ªçc', 'success');
                    }
                );
            }

            updatePreview() {
                const title = document.getElementById('courseTitle').value || 'T√™n kh√≥a h·ªçc';
                const description = document.getElementById('courseDescription').value || 'M√¥ t·∫£ kh√≥a h·ªçc';
                
                document.getElementById('previewTitle').textContent = title;
                document.getElementById('previewDescription').textContent = description;
                
                // Generate detailed preview
                const details = document.getElementById('previewDetails');
                details.innerHTML = `
                    <h3>üìã Th√¥ng tin chi ti·∫øt</h3>
                    <p><strong>Danh m·ª•c:</strong> ${document.getElementById('courseCategory').selectedOptions[0]?.text || 'Ch∆∞a ch·ªçn'}</p>
                    <p><strong>ƒê·ªô kh√≥:</strong> ${document.getElementById('courseDifficulty').selectedOptions[0]?.text}</p>
                    <p><strong>Th·ªùi l∆∞·ª£ng:</strong> ${document.getElementById('courseDuration').value} gi·ªù</p>
                    <p><strong>S·ªë b√†i h·ªçc:</strong> ${this.lessons.length}</p>
                    <p><strong>Tr·∫°ng th√°i:</strong> ${document.getElementById('courseStatus').selectedOptions[0]?.text}</p>
                `;
            }

            collectFormData() {
                // Collect objectives
                const objectives = Array.from(document.querySelectorAll('#learningObjectives input'))
                    .map(input => input.value.trim())
                    .filter(value => value);

                // Collect prerequisites
                const prerequisites = Array.from(document.querySelectorAll('#prerequisites input'))
                    .map(input => input.value.trim())
                    .filter(value => value);

                return {
                    title: document.getElementById('courseTitle').value.trim(),
                    description: document.getElementById('courseDescription').value.trim(),
                    detailedDescription: document.getElementById('courseDetailedDescription').value.trim(),
                    categoryId: document.getElementById('courseCategory').value,
                    difficulty: document.getElementById('courseDifficulty').value,
                    duration: parseInt(document.getElementById('courseDuration').value),
                    language: document.getElementById('courseLanguage').value,
                    status: document.getElementById('courseStatus').value,
                    isPublic: document.getElementById('coursePublic').checked,
                    featured: document.getElementById('courseFeatured').checked,
                    type: document.getElementById('courseType').value,
                    price: document.getElementById('coursePrice').value,
                    startDate: document.getElementById('courseStartDate').value,
                    endDate: document.getElementById('courseEndDate').value,
                    maxStudents: parseInt(document.getElementById('maxStudents').value),
                    autoEnroll: document.getElementById('autoEnroll').checked,
                    objectives: objectives,
                    prerequisites: prerequisites,
                    lessons: this.lessons,
                    thumbnail: this.courseThumbnail || null
                };
            }

            saveDraft() {
                const courseData = this.collectFormData();
                courseData.status = 'draft';
                this.saveCourseData(courseData, 'ƒê√£ l∆∞u b·∫£n nh√°p');
            }

            saveCourse() {
                const courseData = this.collectFormData();
                
                if (!courseData.title) {
                    uiManager.showToast('Vui l√≤ng nh·∫≠p t√™n kh√≥a h·ªçc', 'warning');
                    return;
                }

                if (!courseData.categoryId) {
                    uiManager.showToast('Vui l√≤ng ch·ªçn danh m·ª•c', 'warning');
                    return;
                }

                this.saveCourseData(courseData, 'ƒê√£ l∆∞u kh√≥a h·ªçc th√†nh c√¥ng!');
            }

            publishCourse() {
                const courseData = this.collectFormData();
                
                if (!courseData.title || !courseData.categoryId || this.lessons.length === 0) {
                    uiManager.showToast('Vui l√≤ng ho√†n thi·ªán th√¥ng tin v√† th√™m √≠t nh·∫•t 1 b√†i h·ªçc', 'warning');
                    return;
                }

                courseData.status = 'published';
                this.saveCourseData(courseData, 'ƒê√£ xu·∫•t b·∫£n kh√≥a h·ªçc th√†nh c√¥ng!');
            }

            saveCourseData(courseData, message) {
                // Load existing courses
                const courses = JSON.parse(localStorage.getItem('courses') || '[]');
                
                if (this.currentCourse) {
                    // Update existing course
                    const index = courses.findIndex(c => c.courseId === this.currentCourse.courseId);
                    courses[index] = { ...this.currentCourse, ...courseData, lastModified: new Date().toISOString() };
                } else {
                    // Create new course
                    const newCourse = {
                        courseId: Date.now().toString(),
                        instructor: authManager.getCurrentUser().username,
                        rating: 0,
                        studentsEnrolled: 0,
                        created: new Date().toISOString(),
                        ...courseData
                    };
                    courses.push(newCourse);
                }

                // Save courses
                localStorage.setItem('courses', JSON.stringify(courses));
                
                // Log activity
                authManager.logActivity('Course Management', 
                    `${this.currentCourse ? 'Updated' : 'Created'} course: ${courseData.title}`);

                uiManager.showToast(message, 'success');
                
                // Redirect after save
                setTimeout(() => {
                    window.location.href = 'courses.html';
                }, 1500);
            }
        }

        // Initialize course editor
        let courseEditor;
        document.addEventListener('DOMContentLoaded', () => {
            courseEditor = new CourseEditor();
        });
    </script>
</body>
</html> 

