<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xem b√†i h·ªçc | E-Learning Platform</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    
    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        .lesson-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: var(--spacing-lg);
            height: calc(100vh - var(--header-height) - var(--spacing-lg) * 2);
        }

        .lesson-main {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .lesson-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            background: var(--light-gray);
        }

        .breadcrumb {
            font-size: var(--font-size-small);
            color: #666;
            margin-bottom: var(--spacing-sm);
        }

        .breadcrumb a {
            color: var(--primary-blue);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .lesson-title {
            font-size: var(--font-size-h2);
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: var(--spacing-sm);
        }

        .lesson-meta {
            display: flex;
            gap: var(--spacing-lg);
            font-size: var(--font-size-small);
            color: #666;
        }

        .lesson-content {
            flex: 1;
            padding: var(--spacing-lg);
            overflow-y: auto;
        }

        /* Video Player */
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            margin-bottom: var(--spacing-lg);
        }

        .video-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: var(--border-radius-md);
        }

        /* PDF Viewer */
        .pdf-container {
            width: 100%;
            height: 500px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            margin-bottom: var(--spacing-lg);
        }

        .pdf-viewer {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: var(--border-radius-md);
        }

        /* Markdown Content */
        .markdown-content {
            line-height: 1.6;
            color: var(--dark-gray);
        }

        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3,
        .markdown-content h4,
        .markdown-content h5,
        .markdown-content h6 {
            margin-top: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            color: var(--dark-gray);
        }

        .markdown-content h1 {
            font-size: var(--font-size-h1);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: var(--spacing-sm);
        }

        .markdown-content h2 {
            font-size: var(--font-size-h2);
        }

        .markdown-content h3 {
            font-size: var(--font-size-h3);
        }

        .markdown-content p {
            margin-bottom: var(--spacing-md);
        }

        .markdown-content ul,
        .markdown-content ol {
            margin-bottom: var(--spacing-md);
            padding-left: var(--spacing-lg);
        }

        .markdown-content li {
            margin-bottom: var(--spacing-xs);
        }

        .markdown-content code {
            background: var(--light-gray);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .markdown-content pre {
            background: var(--light-gray);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-md);
            overflow-x: auto;
            margin-bottom: var(--spacing-md);
        }

        .markdown-content pre code {
            background: none;
            padding: 0;
        }

        .markdown-content blockquote {
            border-left: 4px solid var(--primary-blue);
            padding-left: var(--spacing-md);
            margin: var(--spacing-md) 0;
            color: #666;
            font-style: italic;
        }

        .markdown-content img {
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius-md);
            margin: var(--spacing-md) 0;
        }

        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
        }

        .markdown-content th,
        .markdown-content td {
            border: 1px solid var(--border-color);
            padding: var(--spacing-sm);
            text-align: left;
        }

        .markdown-content th {
            background: var(--light-gray);
            font-weight: 600;
        }

        /* Lesson Footer */
        .lesson-footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
            background: var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .completion-section {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .progress-indicator {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-small);
            color: #666;
        }

        .lesson-navigation {
            display: flex;
            gap: var(--spacing-sm);
        }

        /* Sidebar */
        .lesson-sidebar {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            height: fit-content;
            max-height: calc(100vh - var(--header-height) - var(--spacing-lg) * 2);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            background: var(--light-gray);
        }

        .course-info {
            text-align: center;
        }

        .course-title {
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--dark-gray);
        }

        .course-progress {
            margin-bottom: var(--spacing-md);
        }

        .progress-bar {
            background: var(--border-color);
            height: 8px;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            margin-bottom: var(--spacing-xs);
        }

        .progress-fill {
            background: var(--accent-green);
            height: 100%;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: var(--font-size-small);
            color: #666;
        }

        .lessons-list {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-sm);
        }

        .lesson-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: var(--spacing-xs);
        }

        .lesson-item:hover {
            background: var(--light-gray);
        }

        .lesson-item.current {
            background: rgba(44, 110, 170, 0.1);
            border-left: 4px solid var(--primary-blue);
        }

        .lesson-item.completed {
            background: rgba(76, 175, 80, 0.05);
        }

        .lesson-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size-small);
            font-weight: bold;
            flex-shrink: 0;
        }

        .lesson-item.completed .lesson-number {
            background: var(--accent-green);
            color: var(--white);
        }

        .lesson-item.current .lesson-number {
            background: var(--primary-blue);
            color: var(--white);
        }

        .lesson-info {
            flex: 1;
            min-width: 0;
        }

        .lesson-name {
            font-weight: 500;
            margin-bottom: var(--spacing-xs);
            color: var(--dark-gray);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .lesson-duration {
            font-size: var(--font-size-small);
            color: #666;
        }

        .lesson-type-icon {
            font-size: 1.2em;
            flex-shrink: 0;
        }

        /* Notes Section */
        .notes-section {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--border-color);
        }

        .notes-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .notes-title {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .notes-textarea {
            width: 100%;
            min-height: 100px;
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-md);
            resize: vertical;
            font-size: var(--font-size-small);
        }

        .notes-actions {
            margin-top: var(--spacing-sm);
            display: flex;
            gap: var(--spacing-sm);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .lesson-layout {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr auto;
                height: auto;
            }
            
            .lesson-sidebar {
                max-height: 400px;
            }
        }

        @media (max-width: 768px) {
            .lesson-header {
                padding: var(--spacing-md);
            }
            
            .lesson-content {
                padding: var(--spacing-md);
            }
            
            .lesson-footer {
                padding: var(--spacing-md);
                flex-direction: column;
                gap: var(--spacing-md);
            }
            
            .lesson-navigation {
                width: 100%;
                justify-content: space-between;
            }
            
            .video-container {
                padding-bottom: 75%; /* 4:3 aspect ratio for mobile */
            }
        }

        /* Loading States */
        .loading-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 300px;
            background: var(--light-gray);
            border-radius: var(--border-radius-md);
            color: #666;
            font-style: italic;
        }

        .error-message {
            padding: var(--spacing-lg);
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid #f44336;
            border-radius: var(--border-radius-md);
            color: #f44336;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="hamburger" id="hamburgerBtn">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="header-logo">üìö EduPlatform</div>
        </div>
        <div class="header-right">
            <div class="header-user" id="userInfo">
                <div class="header-avatar" id="userAvatar">S</div>
                <div class="header-user-info">
                    <span class="header-username" id="userName">Student</span>
                    <span class="header-role" id="userRole">Sinh vi√™n</span>
                </div>
            </div>
            <button class="theme-toggle" onclick="window.themeManager?.toggleTheme()" title="Chuy·ªÉn ƒë·ªïi giao di·ªán">
                <span class="theme-icon">üåô</span>
            </button>
            <button class="btn btn-secondary btn-small" onclick="authManager.logout()">
                ƒêƒÉng xu·∫•t
            </button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Content -->
        <main class="content main-content" id="content">
            <div class="lesson-layout">
                <!-- Main Lesson Area -->
                <div class="lesson-main">
                    <!-- Lesson Header -->
                    <div class="lesson-header">
                        <div class="breadcrumb">
                            <a href="courses.html">Kh√≥a h·ªçc</a> > 
                            <a href="#" id="courseBreadcrumb">T√™n kh√≥a h·ªçc</a> > 
                            <span id="lessonBreadcrumb">B√†i h·ªçc</span>
                        </div>
                        <h1 class="lesson-title" id="lessonTitle">Ti√™u ƒë·ªÅ b√†i h·ªçc</h1>
                        <div class="lesson-meta">
                            <span id="lessonType">üìπ Video</span>
                            <span id="lessonDuration">‚è±Ô∏è 15 ph√∫t</span>
                            <span id="lessonProgress">üìä Ch∆∞a ho√†n th√†nh</span>
                        </div>
                    </div>

                    <!-- Lesson Content -->
                    <div class="lesson-content" id="lessonContent">
                        <div class="loading-placeholder">
                            ƒêang t·∫£i n·ªôi dung b√†i h·ªçc...
                        </div>
                    </div>

                    <!-- Lesson Footer -->
                    <div class="lesson-footer">
                        <div class="completion-section">
                            <label class="checkbox-container">
                                <input type="checkbox" id="markCompleted">
                                <span class="checkmark"></span>
                                ƒê√°nh d·∫•u l√† ƒë√£ ho√†n th√†nh
                            </label>
                            <div class="progress-indicator">
                                <span id="currentLessonIndex">1</span> / <span id="totalLessons">10</span> b√†i h·ªçc
                            </div>
                        </div>
                        
                        <div class="lesson-navigation">
                            <button class="btn btn-secondary" id="prevButton" onclick="lessonViewer.goToPrevious()">
                                ‚Üê B√†i tr∆∞·ªõc
                            </button>
                            <button class="btn btn-primary" id="nextButton" onclick="lessonViewer.goToNext()">
                                B√†i ti·∫øp theo ‚Üí
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="lesson-sidebar">
                    <!-- Course Info -->
                    <div class="sidebar-header">
                        <div class="course-info">
                            <h3 class="course-title" id="sidebarCourseTitle">T√™n kh√≥a h·ªçc</h3>
                            <div class="course-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="courseProgressBar" style="width: 0%"></div>
                                </div>
                                <div class="progress-text">
                                    <span id="courseProgressText">0% ho√†n th√†nh</span>
                                </div>
                            </div>
                            <button class="btn btn-secondary btn-small" onclick="lessonViewer.goToCourseDetail()">
                                üìö Xem kh√≥a h·ªçc
                            </button>
                        </div>
                    </div>

                    <!-- Lessons List -->
                    <div class="lessons-list" id="lessonsList">
                        <!-- Lessons will be loaded here -->
                    </div>

                    <!-- Notes Section -->
                    <div class="notes-section">
                        <div class="notes-header">
                            <h4 class="notes-title">üìù Ghi ch√∫</h4>
                        </div>
                        <textarea 
                            class="notes-textarea" 
                            id="lessonNotes" 
                            placeholder="Vi·∫øt ghi ch√∫ c·ªßa b·∫°n v·ªÅ b√†i h·ªçc n√†y..."
                        ></textarea>
                        <div class="notes-actions">
                            <button class="btn btn-primary btn-small" onclick="lessonViewer.saveNotes()">
                                üíæ L∆∞u ghi ch√∫
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer" id="footer">
        <p>&copy; 2025 E-Learning Platform. Ph√°t tri·ªÉn b·ªüi <strong>T√πng Huynh</strong> üé®üíª</p>
    </footer>

    <!-- JavaScript -->
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/components/menu-manager.js"></script>
    <script>
        class LessonViewer {
            constructor() {
                this.currentUser = null;
                this.course = null;
                this.lessons = [];
                this.currentLesson = null;
                this.courseId = null;
                this.lessonId = null;
                this.currentLessonIndex = 0;
                this.userProgress = null;
                this.completedLessons = [];
                
                this.init();
            }

            async init() {
                // Check authentication
                if (!authManager.checkPageAccess(['student', 'teacher', 'admin'])) {
                    return;
                }

                // Get parameters from URL
                const urlParams = new URLSearchParams(window.location.search);
                this.courseId = urlParams.get('courseId');
                this.lessonId = urlParams.get('lessonId');
                
                if (!this.courseId || !this.lessonId) {
                    uiManager.showToast('Thi·∫øu th√¥ng tin kh√≥a h·ªçc ho·∫∑c b√†i h·ªçc', 'error');
                    window.location.href = 'courses.html';
                    return;
                }

                this.currentUser = authManager.getCurrentUser();
                this.updateUserInfo();
                this.bindEvents();
                
                await this.loadData();
                
                // Only render if lesson data was loaded successfully
                if (this.currentLesson && this.course) {
                    this.renderLesson();
                } else {
                    console.error('Lesson or course data not loaded, cannot render');
                }
            }

            bindEvents() {
                // Hamburger menu
                document.getElementById('hamburgerBtn').addEventListener('click', () => {
                    this.toggleSidebar();
                });

                // Mark as completed checkbox
                document.getElementById('markCompleted').addEventListener('change', (e) => {
                    this.toggleLessonCompletion(e.target.checked);
                });

                // Auto-save notes
                document.getElementById('lessonNotes').addEventListener('input', () => {
                    this.debounceAutoSave();
                });

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch (e.key) {
                            case 'ArrowLeft':
                                e.preventDefault();
                                this.goToPrevious();
                                break;
                            case 'ArrowRight':
                                e.preventDefault();
                                this.goToNext();
                                break;
                        }
                    }
                });
            }

            toggleSidebar() {
                // For lesson viewer, we don't have the main sidebar
                // This is for responsive mobile layout
                const sidebar = document.querySelector('.lesson-sidebar');
                sidebar.classList.toggle('mobile-hidden');
            }

            updateUserInfo() {
                if (this.currentUser) {
                    document.getElementById('userName').textContent = this.currentUser.fullName || this.currentUser.username;
                    document.getElementById('userAvatar').textContent = this.currentUser.fullName ? this.currentUser.fullName.charAt(0).toUpperCase() : 'U';
                }
            }

            async loadData() {
                try {
                    // Load course data from localStorage first, fallback to JSON file
                    let courses = [];
                    
                    // Try to load from localStorage
                    const savedCourses = localStorage.getItem('courses');
                    if (savedCourses) {
                        courses = JSON.parse(savedCourses);
                    } else {
                        // Create initial mock data if localStorage is empty
                        const mockCourses = [
                            {
                                courseId: 'course1',
                                title: 'L·∫≠p tr√¨nh JavaScript c∆° b·∫£n',
                                description: 'H·ªçc JavaScript t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao',
                                category: 'L·∫≠p tr√¨nh',
                                duration: '20h',
                                level: 'Beginner',
                                rating: 4.5,
                                price: 0,
                                instructor: 'Nguy·ªÖn VƒÉn A',
                                lessons: [
                                    { 
                                        lessonId: 'js1', 
                                        title: 'Gi·ªõi thi·ªáu JavaScript', 
                                        type: 'video', 
                                        duration: '30',
                                        url: 'https://www.youtube.com/watch?v=W6NZfCO5SIk',
                                        description: 'T√¨m hi·ªÉu v·ªÅ JavaScript v√† l·ªãch s·ª≠ ph√°t tri·ªÉn'
                                    },
                                    { 
                                        lessonId: 'js2', 
                                        title: 'Bi·∫øn v√† ki·ªÉu d·ªØ li·ªáu', 
                                        type: 'video', 
                                        duration: '45',
                                        url: 'https://www.youtube.com/watch?v=hdI2bqOjy3c',
                                        description: 'H·ªçc v·ªÅ bi·∫øn v√† c√°c ki·ªÉu d·ªØ li·ªáu trong JavaScript'
                                    },
                                    { 
                                        lessonId: 'js3', 
                                        title: 'C√∫ ph√°p v√† c·∫•u tr√∫c ƒëi·ªÅu khi·ªÉn', 
                                        type: 'markdown', 
                                        duration: '50',
                                        content: `# C√∫ ph√°p v√† c·∫•u tr√∫c ƒëi·ªÅu khi·ªÉn JavaScript

## M·ª•c ti√™u h·ªçc t·∫≠p

Sau b√†i h·ªçc n√†y, b·∫°n s·∫Ω hi·ªÉu ƒë∆∞·ª£c:
- C√∫ ph√°p c∆° b·∫£n c·ªßa JavaScript
- C√°c c·∫•u tr√∫c ƒëi·ªÅu khi·ªÉn: if/else, switch, loops
- C√°ch s·ª≠ d·ª•ng functions

## 1. C√∫ ph√°p c∆° b·∫£n

JavaScript l√† ng√¥n ng·ªØ **case-sensitive** v√† s·ª≠ d·ª•ng **Unicode**.

### Khai b√°o bi·∫øn

\`\`\`javascript
// S·ª≠ d·ª•ng let cho bi·∫øn c√≥ th·ªÉ thay ƒë·ªïi
let userName = "John";
let age = 25;

// S·ª≠ d·ª•ng const cho h·∫±ng s·ªë
const PI = 3.14159;
const apiUrl = "https://api.example.com";

// Tr√°nh s·ª≠ d·ª•ng var (deprecated)
var oldStyle = "avoid this";
\`\`\`

### Ki·ªÉu d·ªØ li·ªáu

1. **Primitive types**:
   - \`number\`: 42, 3.14
   - \`string\`: "Hello World"
   - \`boolean\`: true, false
   - \`undefined\`: undefined
   - \`null\`: null

2. **Object types**:
   - \`object\`: {}, []
   - \`function\`: function() {}

## 2. C·∫•u tr√∫c ƒëi·ªÅu khi·ªÉn

### If/Else statement

\`\`\`javascript
if (age >= 18) {
    console.log("B·∫°n ƒë√£ tr∆∞·ªüng th√†nh");
} else if (age >= 13) {
    console.log("B·∫°n l√† thi·∫øu ni√™n");
} else {
    console.log("B·∫°n c√≤n nh·ªè");
}
\`\`\`

### Switch statement

\`\`\`javascript
switch (dayOfWeek) {
    case 'Monday':
        console.log("Th·ª© 2");
        break;
    case 'Tuesday':
        console.log("Th·ª© 3");
        break;
    default:
        console.log("Ng√†y kh√°c");
}
\`\`\`

### V√≤ng l·∫∑p

\`\`\`javascript
// For loop
for (let i = 0; i < 5; i++) {
    console.log(i);
}

// While loop
let count = 0;
while (count < 3) {
    console.log(count);
    count++;
}

// For...of loop (ES6)
const fruits = ['apple', 'banana', 'orange'];
for (const fruit of fruits) {
    console.log(fruit);
}
\`\`\`

## 3. Functions

### Function declaration

\`\`\`javascript
function greet(name) {
    return "Hello, " + name + "!";
}
\`\`\`

### Arrow function (ES6)

\`\`\`javascript
const greet = (name) => {
    return \`Hello, \${name}!\`;
};

// Short form
const add = (a, b) => a + b;
\`\`\`

## B√†i t·∫≠p th·ª±c h√†nh

1. **B√†i t·∫≠p 1**: Vi·∫øt function ki·ªÉm tra s·ªë ch·∫µn/l·∫ª
2. **B√†i t·∫≠p 2**: T·∫°o v√≤ng l·∫∑p in ra b·∫£ng c·ª≠u ch∆∞∆°ng
3. **B√†i t·∫≠p 3**: S·ª≠ d·ª•ng switch ƒë·ªÉ chuy·ªÉn ƒë·ªïi s·ªë th√†nh t√™n th√°ng

> **üí° Tip**: H√£y th·ª±c h√†nh vi·∫øt code trong browser console ƒë·ªÉ hi·ªÉu r√µ h∆°n!

## T·ªïng k·∫øt

Trong b√†i h·ªçc n√†y ch√∫ng ta ƒë√£ t√¨m hi·ªÉu v·ªÅ:
- ‚úÖ C√∫ ph√°p c∆° b·∫£n c·ªßa JavaScript
- ‚úÖ C√°c c·∫•u tr√∫c ƒëi·ªÅu khi·ªÉn
- ‚úÖ C√°ch khai b√°o v√† s·ª≠ d·ª•ng functions

**B√†i h·ªçc ti·∫øp theo**: Objects v√† Arrays trong JavaScript`,
                                        description: 'T√¨m hi·ªÉu v·ªÅ c√∫ ph√°p v√† c·∫•u tr√∫c ƒëi·ªÅu khi·ªÉn trong JavaScript'
                                    },
                                    { 
                                        lessonId: 'js4', 
                                        title: 'T√†i li·ªáu JavaScript Reference', 
                                        type: 'pdf', 
                                        duration: '30',
                                        url: 'https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf',
                                        description: 'T√†i li·ªáu tham kh·∫£o v·ªÅ JavaScript API v√† best practices'
                                    }
                                ]
                            },
                            {
                                courseId: 'course2',
                                title: 'Thi·∫øt k·∫ø UI/UX',
                                description: 'H·ªçc thi·∫øt k·∫ø giao di·ªán ng∆∞·ªùi d√πng',
                                category: 'Thi·∫øt k·∫ø',
                                duration: '15h',
                                level: 'Intermediate',
                                rating: 4.3,
                                price: 500000,
                                instructor: 'Tr·∫ßn Th·ªã B',
                                lessons: [
                                    { 
                                        lessonId: 'ux1', 
                                        title: 'Nguy√™n l√Ω thi·∫øt k·∫ø', 
                                        type: 'video', 
                                        duration: '40',
                                        url: 'https://www.youtube.com/watch?v=0yoP8oANj7I',
                                        description: 'C√°c nguy√™n l√Ω c∆° b·∫£n trong thi·∫øt k·∫ø UI/UX'
                                    },
                                    { 
                                        lessonId: 'ux2', 
                                        title: 'Design Thinking Process', 
                                        type: 'markdown', 
                                        duration: '60',
                                        content: `# Design Thinking Process

## Gi·ªõi thi·ªáu

**Design Thinking** l√† m·ªôt ph∆∞∆°ng ph√°p gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ t·∫≠p trung v√†o con ng∆∞·ªùi, gi√∫p c√°c nh√† thi·∫øt k·∫ø t·∫°o ra nh·ªØng s·∫£n ph·∫©m v√† d·ªãch v·ª• ƒë√°p ·ª©ng nhu c·∫ßu th·ª±c s·ª± c·ªßa ng∆∞·ªùi d√πng.

## 5 giai ƒëo·∫°n c·ªßa Design Thinking

### 1. üéØ Empathize (ƒê·ªìng c·∫£m)

Hi·ªÉu r√µ ng∆∞·ªùi d√πng th√¥ng qua:
- **User interviews**: Ph·ªèng v·∫•n ng∆∞·ªùi d√πng
- **Observation**: Quan s√°t h√†nh vi th·ª±c t·∫ø
- **Journey mapping**: L·∫≠p b·∫£n ƒë·ªì h√†nh tr√¨nh ng∆∞·ªùi d√πng

\`\`\`
C√¢u h·ªèi quan tr·ªçng:
- Ng∆∞·ªùi d√πng c·ªßa t√¥i l√† ai?
- H·ªç ƒëang g·∫∑p v·∫•n ƒë·ªÅ g√¨?
- H·ªç c·∫£m th·∫•y th·∫ø n√†o v·ªÅ v·∫•n ƒë·ªÅ n√†y?
\`\`\`

### 2. üéØ Define (ƒê·ªãnh nghƒ©a)

X√°c ƒë·ªãnh v·∫•n ƒë·ªÅ c·ªët l√µi:
- T·ªïng h·ª£p insights t·ª´ giai ƒëo·∫°n Empathize
- T·∫°o **Problem Statement**
- Ph√°t tri·ªÉn **Point of View**

**Template Problem Statement**:
> *[User] needs [need] because [insight]*

### 3. üí° Ideate (√ù t∆∞·ªüng)

Brainstorm gi·∫£i ph√°p:
- **Brainstorming sessions**
- **Mind mapping**
- **Crazy 8s technique**
- **How Might We questions**

**Quy t·∫Øc Brainstorming**:
1. Defer judgment
2. Strive for quantity
3. Build on ideas of others
4. Stay focused on topic

### 4. üõ†Ô∏è Prototype (Nguy√™n m·∫´u)

T·∫°o phi√™n b·∫£n th·ª≠ nghi·ªám:
- **Paper prototypes**
- **Digital wireframes**
- **Interactive prototypes**

**Lo·∫°i prototype**:
- Low-fidelity: Sketches, paper
- Mid-fidelity: Wireframes
- High-fidelity: Interactive mockups

### 5. üß™ Test (Ki·ªÉm tra)

Th·ª≠ nghi·ªám v·ªõi ng∆∞·ªùi d√πng:
- **Usability testing**
- **A/B testing**
- **Feedback collection**

## Tools cho Design Thinking

### Research Tools
- **Miro/Mural**: Collaboration boards
- **UserVoice**: Feedback collection
- **Hotjar**: User behavior analytics

### Design Tools
- **Figma**: Collaborative design
- **Sketch**: UI design
- **Adobe XD**: Prototyping

### Testing Tools
- **Maze**: Usability testing
- **UsabilityHub**: First click testing
- **Lookback**: Live user interviews

## Case Study: Redesigning a Mobile App

### Problem
App c√≥ t·ª∑ l·ªá ng∆∞·ªùi d√πng quay l·∫°i th·∫•p (20% retention sau 7 ng√†y)

### Process

**1. Empathize**
- Ph·ªèng v·∫•n 20 ng∆∞·ªùi d√πng
- Ph√¢n t√≠ch app store reviews
- Quan s√°t session recordings

**Key Insights**:
- 60% ng∆∞·ªùi d√πng kh√¥ng hi·ªÉu navigation
- 40% g·∫∑p kh√≥ khƒÉn trong onboarding
- 70% mu·ªën c√≥ dark mode

**2. Define**
> *Ng∆∞·ªùi d√πng mobile c·∫ßn m·ªôt onboarding process ƒë∆°n gi·∫£n v√† tr·ª±c quan v√¨ h·ªç kh√¥ng c√≥ th·ªùi gian ƒë·ªÉ h·ªçc c√°ch s·ª≠ d·ª•ng app ph·ª©c t·∫°p*

**3. Ideate**
- Progressive disclosure
- Interactive tutorials
- Simplified navigation
- Dark mode option

**4. Prototype**
- T·∫°o wireframes cho onboarding m·ªõi
- Interactive prototype v·ªõi 3 m√†n h√¨nh ch√≠nh
- Dark mode variants

**5. Test**
- A/B test v·ªõi 1000 users
- Usability testing v·ªõi 10 users
- Analytics tracking

**Results**:
- üìà Retention tƒÉng l√™n 45%
- üìà Task completion rate: 85%
- üìà User satisfaction: 4.2/5

## Best Practices

### ‚úÖ Do's
- Lu√¥n b·∫Øt ƒë·∫ßu v·ªõi ng∆∞·ªùi d√πng
- Iterate quickly v√† th∆∞·ªùng xuy√™n
- Document insights v√† learnings
- Collaborate v·ªõi cross-functional teams

### ‚ùå Don'ts
- Kh√¥ng assume v·ªÅ ng∆∞·ªùi d√πng
- Kh√¥ng fall in love v·ªõi √Ω t∆∞·ªüng ƒë·∫ßu ti√™n
- Kh√¥ng skip testing phase
- Kh√¥ng thi·∫øt k·∫ø trong vacuum

## K·∫øt lu·∫≠n

Design Thinking kh√¥ng ph·∫£i l√† linear process m√† l√† **iterative approach**. B·∫°n c√≥ th·ªÉ quay l·∫°i b·∫•t k·ª≥ giai ƒëo·∫°n n√†o khi c√≥ th√™m insights m·ªõi.

> *"Design thinking is a human-centered approach to innovation that integrates the needs of people, the possibilities of technology, and requirements for business success."* - Tim Brown, IDEO

**Homework**: √Åp d·ª•ng 5 b∆∞·ªõc Design Thinking ƒë·ªÉ gi·∫£i quy·∫øt m·ªôt v·∫•n ƒë·ªÅ trong cu·ªôc s·ªëng h√†ng ng√†y c·ªßa b·∫°n.`,
                                        description: 'T√¨m hi·ªÉu v·ªÅ quy tr√¨nh Design Thinking v√† c√°ch √°p d·ª•ng'
                                    },
                                    { 
                                        lessonId: 'ux3', 
                                        title: 'Figma Fundamentals Guide', 
                                        type: 'pdf', 
                                        duration: '45',
                                        url: 'https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf',
                                        description: 'H∆∞·ªõng d·∫´n chi ti·∫øt v·ªÅ c√°c c√¥ng c·ª• v√† t√≠nh nƒÉng c·ªßa Figma'
                                    }
                                ]
                            }
                        ];
                        localStorage.setItem('courses', JSON.stringify(mockCourses));
                        courses = mockCourses;
                    }
                    
                    this.course = courses.find(course => course.courseId === this.courseId);
                    
                    if (!this.course) {
                        console.warn('Course not found with ID:', this.courseId);
                        
                        // Create a default course for testing
                        this.course = {
                            courseId: this.courseId,
                            title: 'Kh√≥a h·ªçc Demo',
                            description: 'ƒê√¢y l√† kh√≥a h·ªçc demo ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông',
                            category: 'L·∫≠p tr√¨nh',
                            lessons: [
                                {
                                    lessonId: this.lessonId,
                                    title: 'B√†i h·ªçc Demo',
                                    type: 'video',
                                    duration: '30',
                                    url: 'https://www.youtube.com/watch?v=W6NZfCO5SIk',
                                    description: 'B√†i h·ªçc demo t·ª± ƒë·ªông t·∫°o'
                                }
                            ]
                        };
                        
                        uiManager.showToast('ƒêang s·ª≠ d·ª•ng d·ªØ li·ªáu demo cho b√†i h·ªçc', 'info');
                    }

                    this.lessons = this.course.lessons || [];
                    this.currentLesson = this.lessons.find(lesson => lesson.lessonId === this.lessonId);
                    
                    if (!this.currentLesson && this.lessons.length > 0) {
                        // If lessonId not found, use first lesson
                        this.currentLesson = this.lessons[0];
                        this.lessonId = this.currentLesson.lessonId;
                        uiManager.showToast('B√†i h·ªçc kh√¥ng t√¨m th·∫•y, chuy·ªÉn ƒë·∫øn b√†i h·ªçc ƒë·∫ßu ti√™n', 'info');
                    } else if (!this.currentLesson) {
                        // Create a default lesson if no lessons exist
                        this.currentLesson = {
                            lessonId: this.lessonId,
                            title: 'B√†i h·ªçc Demo',
                            type: 'video',
                            duration: '30',
                            url: 'https://www.youtube.com/watch?v=W6NZfCO5SIk',
                            description: 'B√†i h·ªçc demo t·ª± ƒë·ªông t·∫°o'
                        };
                        this.lessons = [this.currentLesson];
                        uiManager.showToast('ƒêang s·ª≠ d·ª•ng b√†i h·ªçc demo', 'info');
                    }

                    this.currentLessonIndex = this.lessons.findIndex(lesson => lesson.lessonId === this.lessonId);

                    // Load user progress
                    if (this.currentUser.role === 'student') {
                        this.loadUserProgress();
                    }

                    // Load lesson notes
                    this.loadLessonNotes();

                } catch (error) {
                    console.error('Error loading lesson data:', error);
                    uiManager.showToast('C√≥ l·ªói khi t·∫£i d·ªØ li·ªáu b√†i h·ªçc', 'error');
                }
            }

            loadUserProgress() {
                if (this.currentUser.progress && this.currentUser.progress.courses) {
                    this.userProgress = this.currentUser.progress.courses.find(c => c.courseId === this.courseId);
                    
                    if (this.userProgress) {
                        // Mock completed lessons based on progress percentage
                        const completedCount = Math.floor(this.lessons.length * (this.userProgress.completed / 100));
                        this.completedLessons = this.lessons.slice(0, completedCount).map(l => l.lessonId);
                    }
                }
            }

            loadLessonNotes() {
                const notesKey = `lesson_notes_${this.courseId}_${this.lessonId}_${this.currentUser.id}`;
                const savedNotes = localStorage.getItem(notesKey);
                if (savedNotes) {
                    document.getElementById('lessonNotes').value = savedNotes;
                }
            }

            renderLesson() {
                // Update breadcrumb and header
                document.getElementById('courseBreadcrumb').textContent = this.course.title;
                document.getElementById('courseBreadcrumb').href = `course-detail.html?id=${this.courseId}`;
                document.getElementById('lessonBreadcrumb').textContent = this.currentLesson.title;
                document.getElementById('lessonTitle').textContent = this.currentLesson.title;
                
                // Update lesson meta
                const typeIcon = this.getTypeIcon(this.currentLesson.type);
                document.getElementById('lessonType').innerHTML = `${typeIcon} ${this.getTypeDisplay(this.currentLesson.type)}`;
                document.getElementById('lessonDuration').innerHTML = `‚è±Ô∏è ${this.currentLesson.duration} ph√∫t`;
                
                // Update completion status
                const isCompleted = this.completedLessons.includes(this.lessonId);
                document.getElementById('lessonProgress').innerHTML = isCompleted ? '‚úÖ ƒê√£ ho√†n th√†nh' : 'üìä Ch∆∞a ho√†n th√†nh';
                document.getElementById('markCompleted').checked = isCompleted;

                // Update navigation
                document.getElementById('currentLessonIndex').textContent = this.currentLessonIndex + 1;
                document.getElementById('totalLessons').textContent = this.lessons.length;
                
                document.getElementById('prevButton').disabled = this.currentLessonIndex === 0;
                document.getElementById('nextButton').disabled = this.currentLessonIndex === this.lessons.length - 1;

                // Render lesson content
                this.renderLessonContent();
                
                // Render sidebar
                this.renderSidebar();
            }

            renderLessonContent() {
                const container = document.getElementById('lessonContent');
                
                // Check if current lesson is loaded
                if (!this.currentLesson) {
                    container.innerHTML = '<div style="text-align: center; padding: 50px;">ƒêang t·∫£i n·ªôi dung b√†i h·ªçc...</div>';
                    return;
                }
                
                switch (this.currentLesson.type) {
                    case 'video':
                        this.renderVideoContent(container);
                        break;
                    case 'pdf':
                        this.renderPDFContent(container);
                        break;
                    case 'markdown':
                        this.renderMarkdownContent(container);
                        break;
                    default:
                        container.innerHTML = '<div class="error-message">Lo·∫°i n·ªôi dung kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£</div>';
                }
            }

            renderVideoContent(container) {
                // Extract video ID from URL (assuming YouTube format)
                const videoUrl = this.currentLesson.url;
                let embedUrl = '';
                
                if (videoUrl.includes('youtube.com/watch?v=')) {
                    const videoId = videoUrl.split('v=')[1].split('&')[0];
                    embedUrl = `https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1`;
                } else if (videoUrl.includes('youtu.be/')) {
                    const videoId = videoUrl.split('youtu.be/')[1].split('?')[0];
                    embedUrl = `https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1`;
                } else {
                    // For demo purposes, use a placeholder
                    embedUrl = 'https://www.youtube.com/embed/dQw4w9WgXcQ?rel=0&modestbranding=1';
                }

                container.innerHTML = `
                    <div class="video-container">
                        <iframe 
                            class="video-player" 
                            src="${embedUrl}"
                            title="${this.currentLesson.title}"
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen>
                        </iframe>
                    </div>
                    ${this.currentLesson.description ? `
                        <div class="lesson-description">
                            <h3>üìù M√¥ t·∫£ b√†i h·ªçc</h3>
                            <p>${this.currentLesson.description}</p>
                        </div>
                    ` : ''}
                `;
            }

            renderPDFContent(container) {
                const pdfUrl = this.currentLesson.url || this.createSamplePDFUrl();
                
                container.innerHTML = `
                    <div class="pdf-container">
                        <div class="pdf-toolbar">
                            <div class="pdf-info">
                                <span class="pdf-icon">üìÑ</span>
                                <span class="pdf-title">${this.currentLesson.title}</span>
                            </div>
                            <div class="pdf-actions">
                                <button class="btn btn-small btn-secondary" onclick="lessonViewer.togglePDFFullscreen()">
                                    üîç To√†n m√†n h√¨nh
                                </button>
                                <a href="${pdfUrl}" target="_blank" class="btn btn-small btn-primary">
                                    üì• T·∫£i xu·ªëng
                                </a>
                            </div>
                        </div>
                        <iframe 
                            class="pdf-viewer" 
                            src="${pdfUrl}#toolbar=1&navpanes=1&view=FitH"
                            title="${this.currentLesson.title}"
                            onload="lessonViewer.handlePDFLoad(this)"
                            onerror="lessonViewer.handlePDFError(this)">
                            <div class="pdf-fallback">
                                <h3>üìÑ Kh√¥ng th·ªÉ hi·ªÉn th·ªã PDF</h3>
                                <p>Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ hi·ªÉn th·ªã PDF tr·ª±c ti·∫øp.</p>
                                <a href="${pdfUrl}" target="_blank" class="btn btn-primary">
                                    üì• T·∫£i xu·ªëng PDF
                                </a>
                            </div>
                        </iframe>
                    </div>
                    ${this.currentLesson.description ? `
                        <div class="lesson-description">
                            <h3>üìù M√¥ t·∫£ b√†i h·ªçc</h3>
                            <p>${this.currentLesson.description}</p>
                        </div>
                    ` : ''}
                `;
            }

            createSamplePDFUrl() {
                // Create a sample PDF blob for demo
                const pdfContent = `%PDF-1.4
1 0 obj
<< /Type /Catalog /Pages 2 0 R >>
endobj
2 0 obj
<< /Type /Pages /Kids [3 0 R] /Count 1 >>
endobj
3 0 obj
<< /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Resources << /Font << /F1 4 0 R >> >> /Contents 5 0 R >>
endobj
4 0 obj
<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>
endobj
5 0 obj
<< /Length 44 >>
stream
BT
/F1 12 Tf
100 700 Td
(${this.currentLesson.title}) Tj
ET
endstream
endobj
xref
0 6
0000000000 65535 f 
0000000010 00000 n 
0000000053 00000 n 
0000000110 00000 n 
0000000252 00000 n 
0000000325 00000 n 
trailer
<< /Size 6 /Root 1 0 R >>
startxref
419
%%EOF`;
                
                const blob = new Blob([pdfContent], { type: 'application/pdf' });
                return URL.createObjectURL(blob);
            }

            handlePDFLoad(iframe) {
                console.log('PDF loaded successfully');
                // You can add loading state management here
            }

            handlePDFError(iframe) {
                console.error('PDF failed to load');
                iframe.style.display = 'none';
                const container = iframe.parentElement;
                container.insertAdjacentHTML('beforeend', `
                    <div class="pdf-error">
                        <h3>‚ùå Kh√¥ng th·ªÉ t·∫£i PDF</h3>
                        <p>T√†i li·ªáu PDF kh√¥ng t·ªìn t·∫°i ho·∫∑c kh√¥ng th·ªÉ truy c·∫≠p.</p>
                        <div class="error-actions">
                            <button class="btn btn-secondary" onclick="lessonViewer.retryPDFLoad('${this.currentLesson.url}')">
                                üîÑ Th·ª≠ l·∫°i
                            </button>
                            <button class="btn btn-primary" onclick="lessonViewer.showDemoPDF()">
                                üìÑ Xem PDF demo
                            </button>
                        </div>
                    </div>
                `);
            }

            togglePDFFullscreen() {
                const iframe = document.querySelector('.pdf-viewer');
                if (iframe) {
                    if (iframe.requestFullscreen) {
                        iframe.requestFullscreen();
                    } else if (iframe.webkitRequestFullscreen) {
                        iframe.webkitRequestFullscreen();
                    } else if (iframe.msRequestFullscreen) {
                        iframe.msRequestFullscreen();
                    }
                }
            }

            retryPDFLoad(url) {
                const iframe = document.querySelector('.pdf-viewer');
                const errorDiv = document.querySelector('.pdf-error');
                if (iframe && errorDiv) {
                    errorDiv.remove();
                    iframe.style.display = 'block';
                    iframe.src = url + '?retry=' + Date.now();
                }
            }

            showDemoPDF() {
                const iframe = document.querySelector('.pdf-viewer');
                const errorDiv = document.querySelector('.pdf-error');
                if (iframe && errorDiv) {
                    errorDiv.remove();
                    iframe.style.display = 'block';
                    iframe.src = this.createSamplePDFUrl();
                }
            }

            renderMarkdownContent(container) {
                // Get markdown content from lesson data
                const markdownContent = this.currentLesson.content || this.currentLesson.url || `
# ${this.currentLesson.title}

## Gi·ªõi thi·ªáu

Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi b√†i h·ªçc **${this.currentLesson.title}**. Trong b√†i h·ªçc n√†y, ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ c√°c kh√°i ni·ªám quan tr·ªçng v√† ·ª©ng d·ª•ng th·ª±c t·∫ø.

## M·ª•c ti√™u h·ªçc t·∫≠p

Sau khi ho√†n th√†nh b√†i h·ªçc n√†y, b·∫°n s·∫Ω c√≥ th·ªÉ:

- Hi·ªÉu ƒë∆∞·ª£c c√°c kh√°i ni·ªám c∆° b·∫£n
- √Åp d·ª•ng ki·∫øn th·ª©c v√†o th·ª±c t·∫ø
- Gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ li√™n quan

## N·ªôi dung ch√≠nh

### 1. Kh√°i ni·ªám c∆° b·∫£n

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.

\`\`\`javascript
// V√≠ d·ª• code
function example() {
    console.log("Hello World!");
}
\`\`\`

### 2. ·ª®ng d·ª•ng th·ª±c t·∫ø

> **L∆∞u √Ω**: ƒêi·ªÅu n√†y r·∫•t quan tr·ªçng trong th·ª±c t·∫ø.

Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.

### 3. B√†i t·∫≠p th·ª±c h√†nh

1. Th·ª±c hi·ªán b√†i t·∫≠p 1
2. Ho√†n th√†nh project mini
3. √în t·∫≠p ki·∫øn th·ª©c ƒë√£ h·ªçc

## T·ªïng k·∫øt

Trong b√†i h·ªçc n√†y, ch√∫ng ta ƒë√£ t√¨m hi·ªÉu v·ªÅ...

---

**B√†i h·ªçc ti·∫øp theo**: [T√™n b√†i h·ªçc ti·∫øp theo](#)
                `;

                // Render markdown using marked.js
                const htmlContent = marked.parse(markdownContent);
                
                container.innerHTML = `
                    <div class="markdown-content">
                        ${htmlContent}
                    </div>
                `;
            }

            renderSidebar() {
                // Check if course data is loaded
                if (!this.course) {
                    console.warn('Course data not loaded in renderSidebar');
                    return;
                }

                // Update course info
                document.getElementById('sidebarCourseTitle').textContent = this.course.title || 'ƒêang t·∫£i...';
                
                // Update progress
                const progressPercent = this.userProgress ? this.userProgress.completed : 0;
                document.getElementById('courseProgressBar').style.width = progressPercent + '%';
                document.getElementById('courseProgressText').textContent = `${progressPercent}% ho√†n th√†nh`;

                // Check if lessons data is loaded
                if (!this.lessons || !Array.isArray(this.lessons)) {
                    console.warn('Lessons data not loaded in renderSidebar');
                    document.getElementById('lessonsList').innerHTML = '<p style="text-align: center; padding: 20px;">ƒêang t·∫£i danh s√°ch b√†i h·ªçc...</p>';
                    return;
                }

                // Render lessons list
                const container = document.getElementById('lessonsList');
                const lessonsHTML = this.lessons.map((lesson, index) => {
                    const isCompleted = this.completedLessons.includes(lesson.lessonId);
                    const isCurrent = lesson.lessonId === this.lessonId;
                    const typeIcon = this.getTypeIcon(lesson.type);
                    
                    return `
                        <div class="lesson-item ${isCompleted ? 'completed' : ''} ${isCurrent ? 'current' : ''}" 
                             onclick="lessonViewer.goToLesson('${lesson.lessonId}')">
                            <div class="lesson-number">
                                ${isCompleted ? '‚úì' : index + 1}
                            </div>
                            <div class="lesson-info">
                                <div class="lesson-name" title="${lesson.title}">${lesson.title}</div>
                                <div class="lesson-duration">${lesson.duration} ph√∫t</div>
                            </div>
                            <div class="lesson-type-icon">${typeIcon}</div>
                        </div>
                    `;
                }).join('');

                container.innerHTML = lessonsHTML;
            }

            getTypeIcon(type) {
                const icons = {
                    'video': 'üìπ',
                    'pdf': 'üìÑ',
                    'markdown': 'üìù'
                };
                return icons[type] || 'üìÑ';
            }

            getTypeDisplay(type) {
                const displays = {
                    'video': 'Video',
                    'pdf': 'PDF',
                    'markdown': 'B√†i ƒë·ªçc'
                };
                return displays[type] || 'N·ªôi dung';
            }

            goToLesson(lessonId) {
                if (lessonId !== this.lessonId) {
                    window.location.href = `lesson.html?courseId=${this.courseId}&lessonId=${lessonId}`;
                }
            }

            goToPrevious() {
                if (this.currentLessonIndex > 0) {
                    const prevLesson = this.lessons[this.currentLessonIndex - 1];
                    this.goToLesson(prevLesson.lessonId);
                }
            }

            goToNext() {
                if (this.currentLessonIndex < this.lessons.length - 1) {
                    const nextLesson = this.lessons[this.currentLessonIndex + 1];
                    this.goToLesson(nextLesson.lessonId);
                }
            }

            goToCourseDetail() {
                window.location.href = `course-detail.html?id=${this.courseId}`;
            }

            toggleLessonCompletion(isCompleted) {
                if (this.currentUser.role !== 'student') return;

                if (isCompleted) {
                    if (!this.completedLessons.includes(this.lessonId)) {
                        this.completedLessons.push(this.lessonId);
                        uiManager.showToast('ƒê√£ ƒë√°nh d·∫•u b√†i h·ªçc l√† ho√†n th√†nh', 'success');
                        
                        // Log activity
                        authManager.logActivity('Lesson Completed', `Completed lesson: ${this.currentLesson.title} in course: ${this.course.title}`);
                    }
                } else {
                    const index = this.completedLessons.indexOf(this.lessonId);
                    if (index > -1) {
                        this.completedLessons.splice(index, 1);
                        uiManager.showToast('ƒê√£ b·ªè ƒë√°nh d·∫•u ho√†n th√†nh', 'info');
                    }
                }

                // Update progress in localStorage
                this.updateUserProgress();
                
                // Update UI
                this.renderLesson();
            }

            updateUserProgress() {
                if (!this.userProgress) return;

                const completedCount = this.completedLessons.length;
                const totalLessons = this.lessons.length;
                const newProgress = Math.round((completedCount / totalLessons) * 100);

                this.userProgress.completed = newProgress;

                // Update in localStorage
                const currentUser = authManager.getCurrentUser();
                if (currentUser.progress && currentUser.progress.courses) {
                    const courseIndex = currentUser.progress.courses.findIndex(c => c.courseId === this.courseId);
                    if (courseIndex !== -1) {
                        currentUser.progress.courses[courseIndex] = this.userProgress;
                        authManager.updateProfile(currentUser);
                    }
                }
            }

            saveNotes() {
                const notes = document.getElementById('lessonNotes').value;
                const notesKey = `lesson_notes_${this.courseId}_${this.lessonId}_${this.currentUser.id}`;
                
                localStorage.setItem(notesKey, notes);
                uiManager.showToast('ƒê√£ l∆∞u ghi ch√∫', 'success');
                
                // Log activity
                authManager.logActivity('Notes Saved', `Saved notes for lesson: ${this.currentLesson.title}`);
            }

            debounceAutoSave() {
                clearTimeout(this.autoSaveTimeout);
                this.autoSaveTimeout = setTimeout(() => {
                    this.saveNotes();
                }, 2000); // Auto-save after 2 seconds of no typing
            }
        }

        // Initialize lesson viewer when DOM is loaded
        let lessonViewer;
        document.addEventListener('DOMContentLoaded', () => {
            lessonViewer = new LessonViewer();
        });
    </script>
</body>
</html> 
